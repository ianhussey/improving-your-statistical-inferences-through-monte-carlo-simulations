<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Writing functions – Improving your statistical inferences through Monte Carlo simulations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/4_data_generating_process_functions.html" rel="next">
<link href="../chapters/2_foundation_concepts.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/3_writing_functions.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Writing functions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Improving your statistical inferences through Monte Carlo simulations</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/1_required_skills.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Required skills</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/2_foundation_concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Foundation concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/3_writing_functions.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Writing functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/4_data_generating_process_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data generating processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/5_analysis_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analysis functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/6_creating_simulation_experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Creating simulation experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/7_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Mapping over functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/8_summarizing_results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Summarizing results</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/9_planning_and_reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Planning and reporting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10_simulation_template.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Simulation template</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/violating_assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Assessing the impact of violating the assumption of normality</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/testing_assumptions_and_conditional_tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The statistical power of assumptions tests and the conditional use of non-parameteric tests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/p_hacking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">p-hacking via different forms of selecting reporting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/p_values_and_confidence_intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Understanding the link between p-values, Confidence Intervals, and power</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/difference_between_significant_and_nonsignificant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">The differences between significant and non-significant is not itself significant</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/standardized_effect_sizes_and_range_restriction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Standardized effect sizes and range restriction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/impact_of_careless_responding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">The impact of one form of careless responding on power and the false positive rate</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/meta_analysis_and_publication_bias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Meta-analysis and publication bias</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/causality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Regression assumes causality</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">License and citation</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-is-a-function" id="toc-what-is-a-function" class="nav-link active" data-scroll-target="#what-is-a-function"><span class="header-section-number">3.1</span> What is a function?</a></li>
  <li><a href="#basic-structure-of-a-function" id="toc-basic-structure-of-a-function" class="nav-link" data-scroll-target="#basic-structure-of-a-function"><span class="header-section-number">3.2</span> Basic structure of a function</a></li>
  <li><a href="#writing-functions" id="toc-writing-functions" class="nav-link" data-scroll-target="#writing-functions"><span class="header-section-number">3.3</span> Writing functions</a>
  <ul class="collapse">
  <li><a href="#key-steps" id="toc-key-steps" class="nav-link" data-scroll-target="#key-steps"><span class="header-section-number">3.3.1</span> Key steps</a></li>
  <li><a href="#why-build-functions-this-way" id="toc-why-build-functions-this-way" class="nav-link" data-scroll-target="#why-build-functions-this-way"><span class="header-section-number">3.3.2</span> Why build functions this way?</a></li>
  <li><a href="#automatic-function-extraction" id="toc-automatic-function-extraction" class="nav-link" data-scroll-target="#automatic-function-extraction"><span class="header-section-number">3.3.3</span> Automatic function extraction</a></li>
  </ul></li>
  <li><a href="#pseudocode" id="toc-pseudocode" class="nav-link" data-scroll-target="#pseudocode"><span class="header-section-number">3.4</span> Pseudocode</a>
  <ul class="collapse">
  <li><a href="#what-does-pseudocode-look-like" id="toc-what-does-pseudocode-look-like" class="nav-link" data-scroll-target="#what-does-pseudocode-look-like"><span class="header-section-number">3.4.1</span> What does pseudocode look like?</a></li>
  <li><a href="#more-complex-example" id="toc-more-complex-example" class="nav-link" data-scroll-target="#more-complex-example"><span class="header-section-number">3.4.2</span> More complex example</a></li>
  </ul></li>
  <li><a href="#argument-defaults" id="toc-argument-defaults" class="nav-link" data-scroll-target="#argument-defaults"><span class="header-section-number">3.5</span> Argument defaults</a></li>
  <li><a href="#checking-inputs" id="toc-checking-inputs" class="nav-link" data-scroll-target="#checking-inputs"><span class="header-section-number">3.6</span> Checking inputs</a>
  <ul class="collapse">
  <li><a href="#checkmate" id="toc-checkmate" class="nav-link" data-scroll-target="#checkmate"><span class="header-section-number">3.6.1</span> checkmate</a></li>
  <li><a href="#base-r-match.arg" id="toc-base-r-match.arg" class="nav-link" data-scroll-target="#base-r-match.arg"><span class="header-section-number">3.6.2</span> Base-R <code>match.arg()</code></a></li>
  <li><a href="#base-r-stop" id="toc-base-r-stop" class="nav-link" data-scroll-target="#base-r-stop"><span class="header-section-number">3.6.3</span> Base-R <code>stop()</code></a></li>
  <li><a href="#assertthat" id="toc-assertthat" class="nav-link" data-scroll-target="#assertthat"><span class="header-section-number">3.6.4</span> assertthat</a></li>
  <li><a href="#do-as-we-say-not-as-we-do" id="toc-do-as-we-say-not-as-we-do" class="nav-link" data-scroll-target="#do-as-we-say-not-as-we-do"><span class="header-section-number">3.6.5</span> Do as we say, not as we do</a></li>
  </ul></li>
  <li><a href="#common-mistakes" id="toc-common-mistakes" class="nav-link" data-scroll-target="#common-mistakes"><span class="header-section-number">3.7</span> Common mistakes</a>
  <ul class="collapse">
  <li><a href="#failing-to-declare-your-function" id="toc-failing-to-declare-your-function" class="nav-link" data-scroll-target="#failing-to-declare-your-function"><span class="header-section-number">3.7.1</span> Failing to declare your function</a></li>
  <li><a href="#code-that-runs-vs.-functions-correctly" id="toc-code-that-runs-vs.-functions-correctly" class="nav-link" data-scroll-target="#code-that-runs-vs.-functions-correctly"><span class="header-section-number">3.7.2</span> Code that runs vs.&nbsp;functions correctly</a></li>
  </ul></li>
  <li><a href="#applied-example-the-false-positive-rate-of-ai-detection-tools" id="toc-applied-example-the-false-positive-rate-of-ai-detection-tools" class="nav-link" data-scroll-target="#applied-example-the-false-positive-rate-of-ai-detection-tools"><span class="header-section-number">3.8</span> Applied example: The false positive rate of AI detection tools</a>
  <ul class="collapse">
  <li><a href="#math" id="toc-math" class="nav-link" data-scroll-target="#math"><span class="header-section-number">3.8.1</span> Math</a></li>
  <li><a href="#write-the-do-stuff" id="toc-write-the-do-stuff" class="nav-link" data-scroll-target="#write-the-do-stuff"><span class="header-section-number">3.8.2</span> Write the ‘do stuff’</a></li>
  <li><a href="#convert-hard-coded-values-to-variables" id="toc-convert-hard-coded-values-to-variables" class="nav-link" data-scroll-target="#convert-hard-coded-values-to-variables"><span class="header-section-number">3.8.3</span> Convert hard-coded values to variables</a></li>
  <li><a href="#wrap-it-in-a-function" id="toc-wrap-it-in-a-function" class="nav-link" data-scroll-target="#wrap-it-in-a-function"><span class="header-section-number">3.8.4</span> Wrap it in a function</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3.9</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#convert-milliseconds-to-seconds" id="toc-convert-milliseconds-to-seconds" class="nav-link" data-scroll-target="#convert-milliseconds-to-seconds"><span class="header-section-number">3.9.1</span> Convert milliseconds to seconds</a></li>
  <li><a href="#convert-n_months-to-n_years-and-round-all-values-up-the-next-year" id="toc-convert-n_months-to-n_years-and-round-all-values-up-the-next-year" class="nav-link" data-scroll-target="#convert-n_months-to-n_years-and-round-all-values-up-the-next-year"><span class="header-section-number">3.9.2</span> Convert n_months to n_years and round all values up the next year</a></li>
  <li><a href="#calcualte-mean-by-group" id="toc-calcualte-mean-by-group" class="nav-link" data-scroll-target="#calcualte-mean-by-group"><span class="header-section-number">3.9.3</span> Calcualte mean by group</a></li>
  <li><a href="#calculate-mean-sd-and-n-by-group" id="toc-calculate-mean-sd-and-n-by-group" class="nav-link" data-scroll-target="#calculate-mean-sd-and-n-by-group"><span class="header-section-number">3.9.4</span> Calculate mean, SD, and N by group</a></li>
  <li><a href="#mean-sd-and-n-by-group-and-differences-in-means-between-groups" id="toc-mean-sd-and-n-by-group-and-differences-in-means-between-groups" class="nav-link" data-scroll-target="#mean-sd-and-n-by-group-and-differences-in-means-between-groups"><span class="header-section-number">3.9.5</span> Mean, SD, and N by group, and differences in means between groups</a></li>
  <li><a href="#generate-a-random-number-between-0-and-9-using-runif" id="toc-generate-a-random-number-between-0-and-9-using-runif" class="nav-link" data-scroll-target="#generate-a-random-number-between-0-and-9-using-runif"><span class="header-section-number">3.9.6</span> Generate a random number between 0 and 9 using <code>runif()</code></a></li>
  <li><a href="#generate-two-random-numbers-between-0-and-9-return-only-the-larger-one" id="toc-generate-two-random-numbers-between-0-and-9-return-only-the-larger-one" class="nav-link" data-scroll-target="#generate-two-random-numbers-between-0-and-9-return-only-the-larger-one"><span class="header-section-number">3.9.7</span> Generate two random numbers between 0 and 9, return only the larger one</a></li>
  <li><a href="#remove-the-ms-suffix-from-data-like-2000-ms" id="toc-remove-the-ms-suffix-from-data-like-2000-ms" class="nav-link" data-scroll-target="#remove-the-ms-suffix-from-data-like-2000-ms"><span class="header-section-number">3.9.8</span> Remove the ’ ms’ suffix from data like “2000 ms”</a></li>
  <li><a href="#tidy-messy-open-ended-gender-data" id="toc-tidy-messy-open-ended-gender-data" class="nav-link" data-scroll-target="#tidy-messy-open-ended-gender-data"><span class="header-section-number">3.9.9</span> Tidy messy open-ended gender data</a></li>
  <li><a href="#tidy-messy-age-data" id="toc-tidy-messy-age-data" class="nav-link" data-scroll-target="#tidy-messy-age-data"><span class="header-section-number">3.9.10</span> Tidy messy age data</a></li>
  <li><a href="#sample-data-from-a-normal-distribution-and-return-a-tibble" id="toc-sample-data-from-a-normal-distribution-and-return-a-tibble" class="nav-link" data-scroll-target="#sample-data-from-a-normal-distribution-and-return-a-tibble"><span class="header-section-number">3.9.11</span> Sample data from a normal distribution and return a tibble</a></li>
  <li><a href="#sample-data-from-a-normal-distribution-round-to-the-nearest-whole-number-and-return-a-tibble" id="toc-sample-data-from-a-normal-distribution-round-to-the-nearest-whole-number-and-return-a-tibble" class="nav-link" data-scroll-target="#sample-data-from-a-normal-distribution-round-to-the-nearest-whole-number-and-return-a-tibble"><span class="header-section-number">3.9.12</span> Sample data from a normal distribution, round to the nearest whole number, and return a tibble</a></li>
  <li><a href="#sample-data-from-a-normal-distribution-calculate-its-average-and-return-a-tibble" id="toc-sample-data-from-a-normal-distribution-calculate-its-average-and-return-a-tibble" class="nav-link" data-scroll-target="#sample-data-from-a-normal-distribution-calculate-its-average-and-return-a-tibble"><span class="header-section-number">3.9.13</span> Sample data from a normal distribution, calculate its average, and return a tibble</a></li>
  <li><a href="#calculate-the-probabilty-of-n-number-of-heads-coin-flips-in-a-row" id="toc-calculate-the-probabilty-of-n-number-of-heads-coin-flips-in-a-row" class="nav-link" data-scroll-target="#calculate-the-probabilty-of-n-number-of-heads-coin-flips-in-a-row"><span class="header-section-number">3.9.14</span> Calculate the probabilty of n number of ‘heads’ coin flips in a row</a></li>
  <li><a href="#sample-data-from-two-normal-disributions-return-a-tibble-with-two-columns-called-intervention-and-control" id="toc-sample-data-from-two-normal-disributions-return-a-tibble-with-two-columns-called-intervention-and-control" class="nav-link" data-scroll-target="#sample-data-from-two-normal-disributions-return-a-tibble-with-two-columns-called-intervention-and-control"><span class="header-section-number">3.9.15</span> Sample data from two normal disributions, return a tibble with two columns called intervention and control</a></li>
  <li><a href="#sample-data-from-two-normal-disributions-return-a-tibble-in-long-format-with-a-score-and-condition-column" id="toc-sample-data-from-two-normal-disributions-return-a-tibble-in-long-format-with-a-score-and-condition-column" class="nav-link" data-scroll-target="#sample-data-from-two-normal-disributions-return-a-tibble-in-long-format-with-a-score-and-condition-column"><span class="header-section-number">3.9.16</span> Sample data from two normal disributions, return a tibble in long format with a ‘score’ and ‘condition’ column</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Writing functions</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Two of the key steps in a simulation study (generate data and analyze data) require us to know how to write functions. This chapter explains what functions are and how to write them.</p>
<section id="what-is-a-function" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="what-is-a-function"><span class="header-section-number">3.1</span> What is a function?</h2>
<p>A function is a piece of code that receives input(s), does something with it, and returns output(s).</p>
<p>To take two very simple example, the <code>sum()</code> function calculates the sum of the number inputs passed to it:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">sum</span>(x, y)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4</code></pre>
</div>
</div>
<p>When we run the code for a given function, we typically refer to this as ‘calling’ the function. The inputs we provide to functions are referred to as ‘arguments’. Functions are called using its name, with its arguments being placed inside round brackets: <code>function_name(argument1, argument2, ... argumentN)</code>.</p>
<p>To take a second example, the <code>abs()</code> function takes a numeric input and calculates their absolute value (i.e., removes the minus sign):</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<p>While base-R contains nearly three thousand functions, they are by no means all the functions you might need while cleaning and analyzing your data. That’s why we use <code>install.packages()</code> and <code>library()</code> to install and load other functions, including those in the tidyverse packages (e.g., <code>select()</code> and <code>mutate()</code>).</p>
<p>When writing simulation studies, we often need to need to define our own custom functions.</p>
<p>Imagine that you often needed to first sum numbers and then find their absolute values. Maybe you get tired of having to write the following every time:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There is a general rule in coding: <em>try not to repeat yourself</em>, because repeating long chunks of code and slightly changing the bits you need is a common source of making errors.</p>
<p>Instead, we could write a custom function for this specific purpose:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define function</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(y, x))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># call function</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="dv">1</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
</div>
<p>Being able to do this becomes very important when a) you need to do something many thousands of times, often with small variations b) the thing you are doing becomes more complicated. You will encounter both when writing simulation studies.</p>
</section>
<section id="basic-structure-of-a-function" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="basic-structure-of-a-function"><span class="header-section-number">3.2</span> Basic structure of a function</h2>
<p>Functions have three components.</p>
<ol type="1">
<li>Inputs</li>
<li>Do stuff</li>
<li>Outputs</li>
</ol>
<p>It is useful to bear these in mind when writing, debugging and using functions. Most of the errors people make in writing code for functions, or their approach to writing that code, come from confusing the elements or forgetting one.</p>
<p>Function usually have name that is used to call the function and use it.* This is done by declaring the function, just as you would a variable, using the assignment operator (<code>&lt;-</code>) and <code>function()</code>, which is the function to define new functions.</p>
<ol type="1">
<li>Inputs. Inside the <code>function()</code> call are the function’s arguments. In this case, <code>x</code> and <code>y</code>.</li>
<li>Do stuff. Between the curly brackets, <code>{ }</code>, code defines what the function does internally.</li>
<li>Outputs. The <code>return()</code> function is used to define what the function should return as output.**</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inputs between ()</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){ </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do stuff, between {}</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(y, x))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outputs in res()</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>* Anonymous functions (i.e., functions that we don’t name) do exist, but we don’t need to know about them right now. ** Coders have arguments about whether ‘explicit’ <code>return()</code>s should be used or not. It is possible not to use <code>return()</code> and still have a function give an output (e.g., by just running the name of the to-be-returned object without it being wrapped in <code>return()</code>). However, when learning about functions and their conceptual components, it is a very useful to be explicit about what the output is. We therefore recommend it in this context.</p>
</section>
<section id="writing-functions" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="writing-functions"><span class="header-section-number">3.3</span> Writing functions</h2>
<p>The worst way to write a function is the way you read the code for it. Instead, write it from the inside out, starting with the ‘do stuff’ and using hard coded values.</p>
<p>Let’s write the <code>absolute_sum()</code> function from scratch, in the way we recommend.</p>
<section id="key-steps" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="key-steps"><span class="header-section-number">3.3.1</span> Key steps</h3>
<section id="step-1-write-the-do-stuff" class="level4" data-number="3.3.1.1">
<h4 data-number="3.3.1.1" class="anchored" data-anchor-id="step-1-write-the-do-stuff"><span class="header-section-number">3.3.1.1</span> Step 1: Write the ‘do stuff’</h4>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get just the sum() working</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">3</span>) </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>temp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get just the abs() working</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="sc">-</span><span class="dv">4</span>) </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>temp2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get them both working together</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">3</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
</section>
<section id="step-2-convert-hard-coded-values-to-variables" class="level4" data-number="3.3.1.2">
<h4 data-number="3.3.1.2" class="anchored" data-anchor-id="step-2-convert-hard-coded-values-to-variables"><span class="header-section-number">3.3.1.2</span> Step 2: Convert hard-coded values to variables</h4>
<p>Declare variables with hard-coded values, and substitute the hard-coded values in the code for these variables.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># declare variables</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># substitute the variables in and check it still works</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># result &lt;- abs(sum(-1, -3))</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<p>These variables will become the function’s arguments.</p>
</section>
<section id="step-3-wrap-it-in-a-function" class="level4" data-number="3.3.1.3">
<h4 data-number="3.3.1.3" class="anchored" data-anchor-id="step-3-wrap-it-in-a-function"><span class="header-section-number">3.3.1.3</span> Step 3: Wrap it in a function</h4>
<p>Decide on a descriptive name for the function. Declare the function using its name, the <code>&lt;-</code> assignment operator, and the <code>function()</code> function. Add curly brackets, <code>{ }</code>, for where the ‘do stuff’ code will go.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NB code will not run</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(){ </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Copy the code into the ‘do stuff’ between the curly brackets.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NB code will not run</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The function still has no inputs or outputs. Add any variables it uses into the inputs between the round brackets, <code>( )</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>At this point, the function will run and won’t throw any errors, but it also doesn’t do what we want it to. For example:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check your learning: Why doesn’t it do what we want it to? How would we fix it?</p>
<div class="callout callout-style-default callout-note callout-titled" title="Click to show answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to show answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The function has no outputs defined.</p>
<p>It calculates the absolute value of the sum and assigns it to the variable <code>results</code>, but it does not return this value to the user. This is due to a concept called ‘variable scoping’, which is a bit more complex and we won’t cover here.</p>
<p>Suffice to say: you can fix this by telling the function to not only calculate this value, but also return it using <code>return()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p>Once fixed, you can now call the function and it works correctly.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
</div>
</section>
</section>
<section id="why-build-functions-this-way" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="why-build-functions-this-way"><span class="header-section-number">3.3.2</span> Why build functions this way?</h3>
<p>Because of variable scoping. Variable scoping means that we are usually unable to see the value of variables defined inside a function from outside that function unless they are returned by the function.</p>
<p>This is probably not what you’re used to in R, which mostly uses ‘global’ variables. For example, you are used to being able to define <code>my_text &lt;- "hello"</code> and then being able to see or use the <code>my_text</code> variable elsewhere in your R script. This is not actually the norm in coding; the scope of variables is often more limited, such as being able to access variables created within a function only inside that function.</p>
<p>Put simply: because you can’t see everything that’s happening inside functions, you can’t debug and fix them. Instead, write the code as you normally do, and convert working code into a function.</p>
</section>
<section id="automatic-function-extraction" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="automatic-function-extraction"><span class="header-section-number">3.3.3</span> Automatic function extraction</h3>
<p>Once you have code that uses variables, you can actually have RStudio do the ‘wrap it’ step for you.</p>
<p>In your local copy of this .qmd, highlight the code in the chunk below, click ‘Code’&gt;‘Extract Function’, name it ‘absolute_sum’, and click ‘ok’. You can see gifs of this <a href="https://www.appsilon.com/post/r-studio-shortcuts-and-tips-part-2">here</a>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<p>Beware: This method isn’t perfect, as it doesn’t add <code>return()</code> around <code>result</code> or ensure that you have written code to create outputs. But it can save you time.</p>
</section>
</section>
<section id="pseudocode" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="pseudocode"><span class="header-section-number">3.4</span> Pseudocode</h2>
<p>Before you write the ‘do stuff’ code inside a function - or indeed any complex code - it’s often helpful to write ‘pseudocode’ first.</p>
<p>Pseudocode is a plain-language or code-like description of what your function should do, which breaks the problem down into smaller steps or operations. It is not valid R code, and it is not meant to run. Instead, it’s a thinking and planning tool: you use it to clarify the logic of your function before you worry about syntax or bugs.</p>
<p>Pseudocode has a number of advantages:</p>
<ul>
<li>It forces you to be explicit about inputs and outputs. Many function bugs happen because we forget what goes in, what comes out, or what happens in between.</li>
<li>It separates the logical problems from the coding problems. You can get the logic right first, then translate it into code.</li>
<li>It makes debugging easier. If your function fails, you can compare your code to your pseudocode step-by-step and find where they diverge.</li>
<li>It helps you communicate with other people in the future who might not understand your code, including your future self. Readers might not understand your code immediately, but they can usually understand pseudocode.</li>
</ul>
<section id="what-does-pseudocode-look-like" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="what-does-pseudocode-look-like"><span class="header-section-number">3.4.1</span> What does pseudocode look like?</h3>
<p>There isn’t one “correct” format of pseudocode. The main goal is always plain-language readability. A common style is: - Start with what the function receives (inputs) - List the steps inside the function (do stuff) - End with what it returns (output)</p>
<p>Here is pseudocode for our <code>absolute_sum()</code> function. Note that there is no particular standard for pseudocode, it is just something between text and code that runs.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>absolute_sum function</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>steps:</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  1. Add two numbers to get their sum</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  2. Take the absolute value of that sum</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  3. Returns the absolute value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Maybe we would then improve this by thinking about basic structure of any function, i.e., separating the inputs, ‘do stuff’ and outputs, and therefore the input variables that are used in the ‘do stuff’.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>absolute_sum function</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>inputs(x, y)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>steps:</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  1. sum x, y</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  2. absolute of sum</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>output:</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  absolute sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We might then look up the existing R functions to do each of these steps, making the pseudocode increasingly code-like.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<pre class="text cell-code"><code>absolute_sum
inputs:
  x, y
do stuff:
  sum &lt;- sum(x, y)
  abs_sum &lt;- abs(sum)
outputs:
  abs_sum</code></pre>
</details>
</div>
<p>At this point, you can get individual parts of the ‘do stuff’ working as R code.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example values</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># draft of 'do stuff'</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>value_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(x, y)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>value_absolute_sum <span class="ot">&lt;-</span> <span class="fu">abs</span>(value_sum)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>value_absolute_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
</div>
<p>At this point, the ‘do stuff’ is working, and your pseudocode is now code. You have enough to go to the ‘wrap it in a function’ step.</p>
</section>
<section id="more-complex-example" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="more-complex-example"><span class="header-section-number">3.4.2</span> More complex example</h3>
<p>The real value of pseudocode shows up when functions are more complex.</p>
<p>For example, here is pseudocode for a very common simulation function that we will explore in the next chapter: generate one dataset for a Randomized Controlled Trial with two conditions, treatment and control, where the data in each condition comes from a normally distributed population.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<pre class="text cell-code"><code>function: generate_data 
necessary steps, but not necessarily implemented in this order:
  1. For control group, draw n_per_group values from a normal distribution with mean mu_control and sd sigma
  2. For treatment group, draw n_per_group values from a normal distribution with mean mu_treatment and sd sigma
  3. Combine both into one a data frame
  4. Create a column that labels the groups, eg "control" vs "treatment"
  5. End up with a data frame with 'group' and 'score' column; output this.
inputs probably needed based on steps:
- n_per_group, mu_control, mu_treatment, sigma</code></pre>
</details>
</div>
<p>Notice something important: this is basically just a checklist. When you convert it to R code, you can translate each step one at a time and test as you go. You may need to reorder or change the steps, but it gives you a plan. If you get lost in your code, you can go back to check the plan.</p>
</section>
</section>
<section id="argument-defaults" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="argument-defaults"><span class="header-section-number">3.5</span> Argument defaults</h2>
<p>Functions often have many arguments, not all of which you want to specify every time. Often, there are reasonable defaults.</p>
<p>For example, imagine we needed a function to both a) calculate the mean of two numbers and b) round this mean. We might define a new function as:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define function</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>rounded_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, n_digits){</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  mean_x_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">round</span>(mean_x_y, <span class="at">digits =</span> n_digits)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># usage</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.55</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.555</code></pre>
</div>
</div>
<p>In psychology, we often round things to two decimal places. If we want to set the <code>n_digits = 2</code> by default, we can define this in the arguments when declaring the function:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rounded_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">n_digits =</span> <span class="dv">2</span>){</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  mean_x_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">round</span>(mean_x_y, <span class="at">digits =</span> n_digits)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, we don’t need to provide n_digits every time. Unless told otherwise, <code>rounded_mean()</code> will use <code>n_digits = 2</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.55</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.555</code></pre>
</div>
</div>
<p>This can be useful when we have a very general function with reasonable defaults. For example, most of <code>effectize::cohens_d()</code>’s arguments have default values:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from its documentation:</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cohens_d</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  x,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="cn">NULL</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pooled_sd =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="dv">0</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">paired =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> <span class="cn">NULL</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">adjust =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">ci =</span> <span class="fl">0.95</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">"two.sided"</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="checking-inputs" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="checking-inputs"><span class="header-section-number">3.6</span> Checking inputs</h2>
<p>Functions written for R packages usually have many checks built into them. Users are likely to use - and misuse - functions in a variety of ways and often need informative feedback messages to help them fix code when it’s wrong.</p>
<p>For example, if you run the code <code>sum("hello", 3)</code>, R will return the error message “Error in sum(”hello”, 3) : invalid ‘type’ (character) of argument” because you cannot add numbers and character variables. R might have it’s flaws but it’s not lawless, we <a href="https://github.com/denysdovhan/wtfjs">leave that to javascript</a>.</p>
<p>Functions written for simulation studies tend to be more ‘brittle’ or ‘fragile’: they work under a more limited range of conditions, don’t handle errors or exceptions as well, and tend to break without returning clear error messages. In part, this is because the people writing stimulation studies know the code is for a specific purpose and don’t need it to be very general. But, in part, it is also because the people writing simulations are less likely to have the same software engineering skillset as R package developers, who are more likely to write functions that follow the principles of “fail early, fail loudly”.</p>
<p>For example, there is nothing stopping us from running the following code using the function we just wrote:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="sc">-</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Think about the function’s arguments and outputs: Does the output represent an error or not?</p>
<div class="callout callout-style-default callout-note callout-titled" title="Click to show answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to show answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Well… it depends. On the one hand, you can’t round a number to less than zero decimal places. On the other hand, this makes certain types of inputs invalid or ignored without telling the user this. In other context, ‘silent failures’ like this might have serious impacts on the results of your simulation.</p>
</div>
</div>
</div>
<section id="checkmate" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="checkmate"><span class="header-section-number">3.6.1</span> checkmate</h3>
<p>Whether or not this specific example represents an error, the situation can be avoided by using adding input checks and error messages to our functions. This makes them ‘harder’, ie less brittle. It will also help you build your R skills towards being able to write R packages yourself.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in the local version of this .qmd file, you can run this code to see the error messages</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(checkmate)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>rounded_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">n_digits =</span> <span class="dv">2</span>) {</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># input checks</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - check that x and y are both single numeric values</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_number</span>(x, <span class="at">finite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_number</span>(y, <span class="at">finite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - check that n_digits is a non-negative integer</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_count</span>(n_digits) </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do stuff</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  mean_x_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">round</span>(mean_x_y, <span class="at">digits =</span> n_digits)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="sc">-</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If you highlight and run the above code in your local version of this .qmd, it will return the error “Error in rounded_mean(x = 2.1, y = 3.01, n_digits = -3) : Assertion on ‘n_digits’ failed: Must be &gt;= 0.”</p>
<p>The {checkmate} library has many other functions for checking other types of inputs.</p>
<p>Note that there are many other ways of checking inputs, including R’s build in methods and other R packages. These include:</p>
</section>
<section id="base-r-match.arg" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="base-r-match.arg"><span class="header-section-number">3.6.2</span> Base-R <code>match.arg()</code></h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in the local version of this .qmd file, you can run this code to see the error messages</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>calculate_stat <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>)) {</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check input </span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - if 'type' isn't "mean" or "median", R stops here and errors</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - if the user provides nothing, it uses the first one ("mean")</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  type <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(type)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"mean"</span>) {</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">mean</span>(x))</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"median"</span>) {</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">median</span>(x))</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">100</span>)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co"># this works </span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="fu">calculate_stat</span>(my_data, <span class="st">"mean"</span>)</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="co"># this works </span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="fu">calculate_stat</span>(my_data, <span class="st">"median"</span>)</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="co"># this fails appropriately ("mode" is not an allowed input)</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="fu">calculate_stat</span>(my_data, <span class="st">"mode"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="base-r-stop" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="base-r-stop"><span class="header-section-number">3.6.3</span> Base-R <code>stop()</code></h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in the local version of this .qmd file, you can run this code to see the error messages</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>double_allowed_inputs <span class="ot">&lt;-</span> <span class="cf">function</span>(val) {</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  allowed <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>val <span class="sc">%in%</span> allowed) {</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"val must be 1, 10, or 100"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(val <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># this works</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">double_allowed_inputs</span>(<span class="at">val =</span> <span class="dv">10</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co"># this fails appropriately</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="fu">double_allowed_inputs</span>(<span class="at">val =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>See also <code>stopifnot()</code>.</p>
</section>
<section id="assertthat" class="level3" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="assertthat"><span class="header-section-number">3.6.4</span> assertthat</h3>
<p>Another R library that is often used for checking inputs is {assertthat}, which focuses on readable error messages.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in the local version of this .qmd file, you can run this code to see the error messages</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(assertthat)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>rounded_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">n_digits =</span> <span class="dv">2</span>) {</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check inputs</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">is.number</span>(x))</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">is.number</span>(y))</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">is.count</span>(n_digits))</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do stuff</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  mean_x_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">round</span>(mean_x_y, <span class="at">digits =</span> n_digits)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="co"># this works</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="dv">10</span>, <span class="dv">20</span>) </span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="co"># this fails with: "x is not a number (a length one numeric vector)."</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>), <span class="at">y =</span> <span class="dv">30</span>) </span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a><span class="co"># this fails with: "n_digits is not a count (a single positive integer)."</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="at">n_digits =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="do-as-we-say-not-as-we-do" class="level3" data-number="3.6.5">
<h3 data-number="3.6.5" class="anchored" data-anchor-id="do-as-we-say-not-as-we-do"><span class="header-section-number">3.6.5</span> Do as we say, not as we do</h3>
<p>SPOILER: Throughout this book, to make the code as simple as possible, we almost universally ignore our own advice here and do not include input checks in the functions we write.</p>
</section>
</section>
<section id="common-mistakes" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="common-mistakes"><span class="header-section-number">3.7</span> Common mistakes</h2>
<section id="failing-to-declare-your-function" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="failing-to-declare-your-function"><span class="header-section-number">3.7.1</span> Failing to declare your function</h3>
<p>The function must be present in your environment to be usable. After you write your function, you must run the code that declares it before you can use it. If you can’t see your function in your environment tab under ‘Functions’, you need to run the code that contains the <code>function()</code> call and assigns it a name.</p>
</section>
<section id="code-that-runs-vs.-functions-correctly" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="code-that-runs-vs.-functions-correctly"><span class="header-section-number">3.7.2</span> Code that runs vs.&nbsp;functions correctly</h3>
<p>You must cautiously check that your function actually <em>works</em> as you expect, not just that the code runs. Give it lots of different input values that should and should not work, and check you get the correct outputs. We have often made the following mistake when writing functions, and you likely will too.</p>
<p>Check your learning: what is the error in this code? Why does it run without errors?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b){</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="dv">1</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Click to show answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to show answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The function’s inputs are defined as a and b, but it actually uses x and y. x and y were defined as global variables earlier in the script, so it will run using these two values every time, eg <code>absolute_sum(1, 5)</code> and <code>absolute_sum(31, 39)</code> will return the same result.</p>
<p>This often happens - as least to us - when we use common object names like <code>dat</code> and forget to rename them when converting code to a function.</p>
</div>
</div>
</div>
</section>
</section>
<section id="applied-example-the-false-positive-rate-of-ai-detection-tools" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="applied-example-the-false-positive-rate-of-ai-detection-tools"><span class="header-section-number">3.8</span> Applied example: The false positive rate of AI detection tools</h2>
<p>Imagine a test has has a false positive rate of 5%, like the standard alpha value for a p-value.</p>
<p>If you apply this test many times to independent cases without applying familywise error corrections, what is the resulting false positive rate?</p>
<p>Let’s put this in meaningful terms: Many professors and universities now run essays and assignments through AI detection tools. But students submit many essays and assignments throughout their degree. What is the probability that, assuming you never violate the AI policy, one of your assignments is falsely flagged as using AI in a way that wasn’t allowed?</p>
<section id="math" class="level3" data-number="3.8.1">
<h3 data-number="3.8.1" class="anchored" data-anchor-id="math"><span class="header-section-number">3.8.1</span> Math</h3>
<p>The familywise error rate (<span class="math inline">\(\alpha_{\text{total}}\)</span>) for independent tests is the probability of observing at least one false positive (<span class="math inline">\(P(V \geq 1)\)</span>), which can be reexpressed as the probability of not observing true positives (<span class="math inline">\(1 - P(V = 0)\)</span>). This is the product of the individual probabilities of false positives (<span class="math inline">\(1 - \prod_{i=1}^{n} (1 - \alpha_i)\)</span>), which simplifies to:</p>
<p><span class="math display">\[
\begin{align}
\alpha_{\text{total}} &amp;= P(V \geq 1) \\
&amp;= 1 - P(V = 0) \\
&amp;= 1 - \prod_{i=1}^{n} (1 - \alpha_i) \\
&amp;= 1 - (1 - \alpha)^n
\end{align}
\]</span></p>
<p>Horrible, disgusting math which most of you want to avoid. But the code to do it is quite simple.</p>
</section>
<section id="write-the-do-stuff" class="level3" data-number="3.8.2">
<h3 data-number="3.8.2" class="anchored" data-anchor-id="write-the-do-stuff"><span class="header-section-number">3.8.2</span> Write the ‘do stuff’</h3>
<p>This code implements the math assuming each individual test’s false positive rate is 5% and that 10 total tests are run. It calculates the aggregate false positive rate, i.e., the probability that at least one test will show a false positive, assuming the null hypothesis is true.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span>)<span class="sc">^</span><span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4012631</code></pre>
</div>
</div>
<p>Check your learning: What do we mean by ‘assuming the null hypothesis is true’ here?</p>
<div class="callout callout-style-default callout-note callout-titled" title="Click to show answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to show answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This calculation only considers false positives, not true positives. In the world it considered - ie assumes - all positives are false positives: no true violations of the AI policy ever occur.</p>
</div>
</div>
</div>
</section>
<section id="convert-hard-coded-values-to-variables" class="level3" data-number="3.8.3">
<h3 data-number="3.8.3" class="anchored" data-anchor-id="convert-hard-coded-values-to-variables"><span class="header-section-number">3.8.3</span> Convert hard-coded values to variables</h3>
<p>What about other values of alpha and n? We could make them variables at the top of the chunk that are easier to change.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># code</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> alpha)<span class="sc">^</span>n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4012631</code></pre>
</div>
</div>
</section>
<section id="wrap-it-in-a-function" class="level3" data-number="3.8.4">
<h3 data-number="3.8.4" class="anchored" data-anchor-id="wrap-it-in-a-function"><span class="header-section-number">3.8.4</span> Wrap it in a function</h3>
<p>Defining our own custom function involves putting the variables as arguments inside the <code>function()</code> call, and putting the code inside its <code>{ }</code>.</p>
<p>We can then call the function using its name.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define function</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>calc_aggregate_fpr <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">alpha =</span> <span class="fl">0.05</span>) {</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> alpha)<span class="sc">^</span>n</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co"># usage</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4012631</code></pre>
</div>
</div>
<p>This also lets us call it an arbitrary number of times, eg for different values of n</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span>  <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2262191</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4012631</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5367088</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6415141</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7226104</code></pre>
</div>
</div>
<p>At this point, we’ll skip over some code and skills we haven’t learned yet. In summary, we use the function we have just created to simulate many different values of <code>n</code> (the number of tests run) and <code>alpha</code> (the test’s alpha value, or nominal false positive rate for a single test) to observe their impact on the familywise error rate across tests. We’ll learn how to do this in future chapters. For the moment, let’s just observe the results.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3_writing_functions_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Despite the test being advertised as having high accuracy, in the sense of a low false-positive rate, there is a strong risk of false positives when many tests are run. Students submit many different assignments over their studies. Assuming no AI policy violations occur, 20 assignments are tested, the tests are independent, and an alpha value of 5% is used, there is a strong risk (&gt; 50%) that individual students will still have at least one of their assignments flagged as an AI policy violation across their studies.</p>
<p>This gets even worse when we consider that there are many students, each of which are submitting many assignments. If we track all 25 students in a symposium over 20 assignments they submit, the estimated familywise false positive rate is 100%. Whew.</p>
</section>
</section>
<section id="exercises" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="exercises"><span class="header-section-number">3.9</span> Exercises</h2>
<p>Write functions for each of the following. Remember that you can write pseudocode first if it helps.</p>
<section id="convert-milliseconds-to-seconds" class="level3" data-number="3.9.1">
<h3 data-number="3.9.1" class="anchored" data-anchor-id="convert-milliseconds-to-seconds"><span class="header-section-number">3.9.1</span> Convert milliseconds to seconds</h3>
</section>
<section id="convert-n_months-to-n_years-and-round-all-values-up-the-next-year" class="level3" data-number="3.9.2">
<h3 data-number="3.9.2" class="anchored" data-anchor-id="convert-n_months-to-n_years-and-round-all-values-up-the-next-year"><span class="header-section-number">3.9.2</span> Convert n_months to n_years and round all values up the next year</h3>
<p>Use <code>ceiling()</code> to round all values ending in something other than .0 up to the next whole value.</p>
</section>
<section id="calcualte-mean-by-group" class="level3" data-number="3.9.3">
<h3 data-number="3.9.3" class="anchored" data-anchor-id="calcualte-mean-by-group"><span class="header-section-number">3.9.3</span> Calcualte mean by group</h3>
<p>What additional arguments might this benefit from to avoid it breaking under common use cases?</p>
</section>
<section id="calculate-mean-sd-and-n-by-group" class="level3" data-number="3.9.4">
<h3 data-number="3.9.4" class="anchored" data-anchor-id="calculate-mean-sd-and-n-by-group"><span class="header-section-number">3.9.4</span> Calculate mean, SD, and N by group</h3>
</section>
<section id="mean-sd-and-n-by-group-and-differences-in-means-between-groups" class="level3" data-number="3.9.5">
<h3 data-number="3.9.5" class="anchored" data-anchor-id="mean-sd-and-n-by-group-and-differences-in-means-between-groups"><span class="header-section-number">3.9.5</span> Mean, SD, and N by group, and differences in means between groups</h3>
<p>Pivot the result to wider format before mutating the difference in means.</p>
</section>
<section id="generate-a-random-number-between-0-and-9-using-runif" class="level3" data-number="3.9.6">
<h3 data-number="3.9.6" class="anchored" data-anchor-id="generate-a-random-number-between-0-and-9-using-runif"><span class="header-section-number">3.9.6</span> Generate a random number between 0 and 9 using <code>runif()</code></h3>
</section>
<section id="generate-two-random-numbers-between-0-and-9-return-only-the-larger-one" class="level3" data-number="3.9.7">
<h3 data-number="3.9.7" class="anchored" data-anchor-id="generate-two-random-numbers-between-0-and-9-return-only-the-larger-one"><span class="header-section-number">3.9.7</span> Generate two random numbers between 0 and 9, return only the larger one</h3>
</section>
<section id="remove-the-ms-suffix-from-data-like-2000-ms" class="level3" data-number="3.9.8">
<h3 data-number="3.9.8" class="anchored" data-anchor-id="remove-the-ms-suffix-from-data-like-2000-ms"><span class="header-section-number">3.9.8</span> Remove the ’ ms’ suffix from data like “2000 ms”</h3>
<p>Use the {stringr} library.</p>
</section>
<section id="tidy-messy-open-ended-gender-data" class="level3" data-number="3.9.9">
<h3 data-number="3.9.9" class="anchored" data-anchor-id="tidy-messy-open-ended-gender-data"><span class="header-section-number">3.9.9</span> Tidy messy open-ended gender data</h3>
<p>You can use the <code>dat_demographics_messy</code> tibble created below.</p>
</section>
<section id="tidy-messy-age-data" class="level3" data-number="3.9.10">
<h3 data-number="3.9.10" class="anchored" data-anchor-id="tidy-messy-age-data"><span class="header-section-number">3.9.10</span> Tidy messy age data</h3>
<p>You can use the <code>dat_demographics_messy</code> tibble again.</p>
</section>
<section id="sample-data-from-a-normal-distribution-and-return-a-tibble" class="level3" data-number="3.9.11">
<h3 data-number="3.9.11" class="anchored" data-anchor-id="sample-data-from-a-normal-distribution-and-return-a-tibble"><span class="header-section-number">3.9.11</span> Sample data from a normal distribution and return a tibble</h3>
<p>Use <code>rnorm()</code></p>
</section>
<section id="sample-data-from-a-normal-distribution-round-to-the-nearest-whole-number-and-return-a-tibble" class="level3" data-number="3.9.12">
<h3 data-number="3.9.12" class="anchored" data-anchor-id="sample-data-from-a-normal-distribution-round-to-the-nearest-whole-number-and-return-a-tibble"><span class="header-section-number">3.9.12</span> Sample data from a normal distribution, round to the nearest whole number, and return a tibble</h3>
</section>
<section id="sample-data-from-a-normal-distribution-calculate-its-average-and-return-a-tibble" class="level3" data-number="3.9.13">
<h3 data-number="3.9.13" class="anchored" data-anchor-id="sample-data-from-a-normal-distribution-calculate-its-average-and-return-a-tibble"><span class="header-section-number">3.9.13</span> Sample data from a normal distribution, calculate its average, and return a tibble</h3>
</section>
<section id="calculate-the-probabilty-of-n-number-of-heads-coin-flips-in-a-row" class="level3" data-number="3.9.14">
<h3 data-number="3.9.14" class="anchored" data-anchor-id="calculate-the-probabilty-of-n-number-of-heads-coin-flips-in-a-row"><span class="header-section-number">3.9.14</span> Calculate the probabilty of n number of ‘heads’ coin flips in a row</h3>
<p>Use <code>rbinom()</code>.</p>
</section>
<section id="sample-data-from-two-normal-disributions-return-a-tibble-with-two-columns-called-intervention-and-control" class="level3" data-number="3.9.15">
<h3 data-number="3.9.15" class="anchored" data-anchor-id="sample-data-from-two-normal-disributions-return-a-tibble-with-two-columns-called-intervention-and-control"><span class="header-section-number">3.9.15</span> Sample data from two normal disributions, return a tibble with two columns called intervention and control</h3>
</section>
<section id="sample-data-from-two-normal-disributions-return-a-tibble-in-long-format-with-a-score-and-condition-column" class="level3" data-number="3.9.16">
<h3 data-number="3.9.16" class="anchored" data-anchor-id="sample-data-from-two-normal-disributions-return-a-tibble-in-long-format-with-a-score-and-condition-column"><span class="header-section-number">3.9.16</span> Sample data from two normal disributions, return a tibble in long format with a ‘score’ and ‘condition’ column</h3>
<p>Use <code>bind_rows()</code>.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/2_foundation_concepts.html" class="pagination-link" aria-label="Foundation concepts">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Foundation concepts</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/4_data_generating_process_functions.html" class="pagination-link" aria-label="Data generating processes">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data generating processes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb70" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Writing functions</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>Two of the key steps in a simulation study (generate data and analyze data) require us to know how to write functions. This chapter explains what functions are and how to write them.</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is a function?</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>A function is a piece of code that receives input(s), does something with it, and returns output(s). </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>To take two very simple example, the <span class="in">`sum()`</span> function calculates the sum of the number inputs passed to it:</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">sum</span>(x, y)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>z</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>When we run the code for a given function, we typically refer to this as 'calling' the function. The inputs we provide to functions are referred to as 'arguments'. Functions are called using its name, with its arguments being placed inside round brackets: <span class="in">`function_name(argument1, argument2, ... argumentN)`</span>. </span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>To take a second example, the <span class="in">`abs()`</span> function takes a numeric input and calculates their absolute value (i.e., removes the minus sign):</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(z)</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>While base-R contains nearly three thousand functions, they are by no means all the functions you might need while cleaning and analyzing your data. That's why we use <span class="in">`install.packages()`</span> and <span class="in">`library()`</span> to install and load other functions, including those in the tidyverse packages (e.g., <span class="in">`select()`</span> and <span class="in">`mutate()`</span>).</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>When writing simulation studies, we often need to need to define our own custom functions. </span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>Imagine that you often needed to first sum numbers and then find their absolute values. Maybe you get tired of having to write the following every time:</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a>There is a general rule in coding: *try not to repeat yourself*, because repeating long chunks of code and slightly changing the bits you need is a common source of making errors.</span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a>Instead, we could write a custom function for this specific purpose:</span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a><span class="co"># define function</span></span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(y, x))</span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a><span class="co"># call function</span></span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">5</span>)</span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">2</span>)</span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a>Being able to do this becomes very important when a) you need to do something many thousands of times, often with small variations b) the thing you are doing becomes more complicated. You will encounter both when writing simulation studies. </span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic structure of a function</span></span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true" tabindex="-1"></a>Functions have three components. </span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Inputs</span>
<span id="cb70-73"><a href="#cb70-73" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Do stuff</span>
<span id="cb70-74"><a href="#cb70-74" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Outputs</span>
<span id="cb70-75"><a href="#cb70-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-76"><a href="#cb70-76" aria-hidden="true" tabindex="-1"></a>It is useful to bear these in mind when writing, debugging and using functions. Most of the errors people make in writing code for functions, or their approach to writing that code, come from confusing the elements or forgetting one. </span>
<span id="cb70-77"><a href="#cb70-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-78"><a href="#cb70-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-79"><a href="#cb70-79" aria-hidden="true" tabindex="-1"></a>Function usually have name that is used to call the function and use it.<span class="sc">\*</span> This is done by declaring the function, just as you would a variable, using the assignment operator (<span class="in">`&lt;-`</span>) and <span class="in">`function()`</span>, which is the function to define new functions. </span>
<span id="cb70-80"><a href="#cb70-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-81"><a href="#cb70-81" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Inputs. Inside the <span class="in">`function()`</span> call are the function's arguments. In this case, <span class="in">`x`</span> and <span class="in">`y`</span>. </span>
<span id="cb70-82"><a href="#cb70-82" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Do stuff. Between the curly brackets, <span class="in">`{ }`</span>, code defines what the function does internally.</span>
<span id="cb70-83"><a href="#cb70-83" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Outputs. The <span class="in">`return()`</span> function is used to define what the function should return as output.<span class="sc">\*\*</span> </span>
<span id="cb70-84"><a href="#cb70-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-87"><a href="#cb70-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-88"><a href="#cb70-88" aria-hidden="true" tabindex="-1"></a><span class="co"># inputs between ()</span></span>
<span id="cb70-89"><a href="#cb70-89" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){ </span>
<span id="cb70-90"><a href="#cb70-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do stuff, between {}</span></span>
<span id="cb70-91"><a href="#cb70-91" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(y, x))</span>
<span id="cb70-92"><a href="#cb70-92" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outputs in res()</span></span>
<span id="cb70-93"><a href="#cb70-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb70-94"><a href="#cb70-94" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-95"><a href="#cb70-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-96"><a href="#cb70-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-97"><a href="#cb70-97" aria-hidden="true" tabindex="-1"></a><span class="sc">\*</span> Anonymous functions (i.e., functions that we don't name) do exist, but we don't need to know about them right now. </span>
<span id="cb70-98"><a href="#cb70-98" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> Coders have arguments about whether 'explicit' <span class="in">`return()`</span>s should be used or not. It is possible not to use <span class="in">`return()`</span> and still have a function give an output (e.g., by just running the name of the to-be-returned object without it being wrapped in <span class="in">`return()`</span>). However, when learning about functions and their conceptual components, it is a very useful to be explicit about what the output is. We therefore recommend it in this context. </span>
<span id="cb70-99"><a href="#cb70-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-100"><a href="#cb70-100" aria-hidden="true" tabindex="-1"></a><span class="fu">## Writing functions </span></span>
<span id="cb70-101"><a href="#cb70-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-102"><a href="#cb70-102" aria-hidden="true" tabindex="-1"></a>The worst way to write a function is the way you read the code for it. Instead, write it from the inside out, starting with the 'do stuff' and using hard coded values.</span>
<span id="cb70-103"><a href="#cb70-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-104"><a href="#cb70-104" aria-hidden="true" tabindex="-1"></a>Let's write the <span class="in">`absolute_sum()`</span> function from scratch, in the way we recommend.</span>
<span id="cb70-105"><a href="#cb70-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-106"><a href="#cb70-106" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key steps</span></span>
<span id="cb70-107"><a href="#cb70-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-108"><a href="#cb70-108" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 1: Write the 'do stuff'</span></span>
<span id="cb70-109"><a href="#cb70-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-112"><a href="#cb70-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-113"><a href="#cb70-113" aria-hidden="true" tabindex="-1"></a><span class="co"># get just the sum() working</span></span>
<span id="cb70-114"><a href="#cb70-114" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">3</span>) </span>
<span id="cb70-115"><a href="#cb70-115" aria-hidden="true" tabindex="-1"></a>temp</span>
<span id="cb70-116"><a href="#cb70-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-117"><a href="#cb70-117" aria-hidden="true" tabindex="-1"></a><span class="co"># get just the abs() working</span></span>
<span id="cb70-118"><a href="#cb70-118" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="sc">-</span><span class="dv">4</span>) </span>
<span id="cb70-119"><a href="#cb70-119" aria-hidden="true" tabindex="-1"></a>temp2</span>
<span id="cb70-120"><a href="#cb70-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-121"><a href="#cb70-121" aria-hidden="true" tabindex="-1"></a><span class="co"># get them both working together</span></span>
<span id="cb70-122"><a href="#cb70-122" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">3</span>))</span>
<span id="cb70-123"><a href="#cb70-123" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb70-124"><a href="#cb70-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-125"><a href="#cb70-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-126"><a href="#cb70-126" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 2: Convert hard-coded values to variables</span></span>
<span id="cb70-127"><a href="#cb70-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-128"><a href="#cb70-128" aria-hidden="true" tabindex="-1"></a>Declare variables with hard-coded values, and substitute the hard-coded values in the code for these variables. </span>
<span id="cb70-129"><a href="#cb70-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-132"><a href="#cb70-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-133"><a href="#cb70-133" aria-hidden="true" tabindex="-1"></a><span class="co"># declare variables</span></span>
<span id="cb70-134"><a href="#cb70-134" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb70-135"><a href="#cb70-135" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb70-136"><a href="#cb70-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-137"><a href="#cb70-137" aria-hidden="true" tabindex="-1"></a><span class="co"># substitute the variables in and check it still works</span></span>
<span id="cb70-138"><a href="#cb70-138" aria-hidden="true" tabindex="-1"></a><span class="co"># result &lt;- abs(sum(-1, -3))</span></span>
<span id="cb70-139"><a href="#cb70-139" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb70-140"><a href="#cb70-140" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb70-141"><a href="#cb70-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-142"><a href="#cb70-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-143"><a href="#cb70-143" aria-hidden="true" tabindex="-1"></a>These variables will become the function's arguments.</span>
<span id="cb70-144"><a href="#cb70-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-145"><a href="#cb70-145" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 3: Wrap it in a function</span></span>
<span id="cb70-146"><a href="#cb70-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-147"><a href="#cb70-147" aria-hidden="true" tabindex="-1"></a>Decide on a descriptive name for the function. Declare the function using its name, the <span class="in">`&lt;-`</span> assignment operator, and the <span class="in">`function()`</span> function. Add curly brackets, <span class="in">`{ }`</span>, for where the 'do stuff' code will go.</span>
<span id="cb70-148"><a href="#cb70-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-151"><a href="#cb70-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-152"><a href="#cb70-152" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb70-153"><a href="#cb70-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb70-154"><a href="#cb70-154" aria-hidden="true" tabindex="-1"></a><span class="co"># NB code will not run</span></span>
<span id="cb70-155"><a href="#cb70-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-156"><a href="#cb70-156" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(){ </span>
<span id="cb70-157"><a href="#cb70-157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-158"><a href="#cb70-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-159"><a href="#cb70-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-160"><a href="#cb70-160" aria-hidden="true" tabindex="-1"></a>Copy the code into the 'do stuff' between the curly brackets.</span>
<span id="cb70-161"><a href="#cb70-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-164"><a href="#cb70-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-165"><a href="#cb70-165" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb70-166"><a href="#cb70-166" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb70-167"><a href="#cb70-167" aria-hidden="true" tabindex="-1"></a><span class="co"># NB code will not run</span></span>
<span id="cb70-168"><a href="#cb70-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-169"><a href="#cb70-169" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb70-170"><a href="#cb70-170" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb70-171"><a href="#cb70-171" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-172"><a href="#cb70-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-173"><a href="#cb70-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-174"><a href="#cb70-174" aria-hidden="true" tabindex="-1"></a>The function still has no inputs or outputs. Add any variables it uses into the inputs between the round brackets, <span class="in">`( )`</span>. </span>
<span id="cb70-175"><a href="#cb70-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-178"><a href="#cb70-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-179"><a href="#cb70-179" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb70-180"><a href="#cb70-180" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb70-181"><a href="#cb70-181" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-182"><a href="#cb70-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-183"><a href="#cb70-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-184"><a href="#cb70-184" aria-hidden="true" tabindex="-1"></a>At this point, the function will run and won't throw any errors, but it also doesn't do what we want it to. For example:</span>
<span id="cb70-185"><a href="#cb70-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-188"><a href="#cb70-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-189"><a href="#cb70-189" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">11</span>)</span>
<span id="cb70-190"><a href="#cb70-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-191"><a href="#cb70-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-192"><a href="#cb70-192" aria-hidden="true" tabindex="-1"></a>Check your learning: Why doesn't it do what we want it to? How would we fix it?</span>
<span id="cb70-193"><a href="#cb70-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-194"><a href="#cb70-194" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true" title="Click to show answer"}</span>
<span id="cb70-195"><a href="#cb70-195" aria-hidden="true" tabindex="-1"></a>The function has no outputs defined. </span>
<span id="cb70-196"><a href="#cb70-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-197"><a href="#cb70-197" aria-hidden="true" tabindex="-1"></a>It calculates the absolute value of the sum and assigns it to the variable <span class="in">`results`</span>, but it does not return this value to the user. This is due to a concept called 'variable scoping', which is a bit more complex and we won't cover here.</span>
<span id="cb70-198"><a href="#cb70-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-199"><a href="#cb70-199" aria-hidden="true" tabindex="-1"></a>Suffice to say: you can fix this by telling the function to not only calculate this value, but also return it using <span class="in">`return()`</span>.</span>
<span id="cb70-200"><a href="#cb70-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-203"><a href="#cb70-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-204"><a href="#cb70-204" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb70-205"><a href="#cb70-205" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb70-206"><a href="#cb70-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb70-207"><a href="#cb70-207" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-208"><a href="#cb70-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-209"><a href="#cb70-209" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-210"><a href="#cb70-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-211"><a href="#cb70-211" aria-hidden="true" tabindex="-1"></a>Once fixed, you can now call the function and it works correctly. </span>
<span id="cb70-214"><a href="#cb70-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-215"><a href="#cb70-215" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">11</span>)</span>
<span id="cb70-216"><a href="#cb70-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-217"><a href="#cb70-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-218"><a href="#cb70-218" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why build functions this way?</span></span>
<span id="cb70-219"><a href="#cb70-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-220"><a href="#cb70-220" aria-hidden="true" tabindex="-1"></a>Because of variable scoping. Variable scoping means that we are usually unable to see the value of variables defined inside a function from outside that function unless they are returned by the function. </span>
<span id="cb70-221"><a href="#cb70-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-222"><a href="#cb70-222" aria-hidden="true" tabindex="-1"></a>This is probably not what you're used to in R, which mostly uses 'global' variables. For example, you are used to being able to define <span class="in">`my_text &lt;- "hello"`</span> and then being able to see or use the <span class="in">`my_text`</span> variable elsewhere in your R script. This is not actually the norm in coding; the scope of variables is often more limited, such as being able to access variables created within a function only inside that function. </span>
<span id="cb70-223"><a href="#cb70-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-224"><a href="#cb70-224" aria-hidden="true" tabindex="-1"></a>Put simply: because you can't see everything that's happening inside functions, you can't debug and fix them. Instead, write the code as you normally do, and convert working code into a function.</span>
<span id="cb70-225"><a href="#cb70-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-226"><a href="#cb70-226" aria-hidden="true" tabindex="-1"></a><span class="fu">### Automatic function extraction</span></span>
<span id="cb70-227"><a href="#cb70-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-228"><a href="#cb70-228" aria-hidden="true" tabindex="-1"></a>Once you have code that uses variables, you can actually have RStudio do the 'wrap it' step for you.</span>
<span id="cb70-229"><a href="#cb70-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-230"><a href="#cb70-230" aria-hidden="true" tabindex="-1"></a>In your local copy of this .qmd, highlight the code in the chunk below, click 'Code'&gt;'Extract Function', name it 'absolute_sum', and click 'ok'. You can see gifs of this <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.appsilon.com/post/r-studio-shortcuts-and-tips-part-2)</span>.</span>
<span id="cb70-231"><a href="#cb70-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-234"><a href="#cb70-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-235"><a href="#cb70-235" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb70-236"><a href="#cb70-236" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb70-237"><a href="#cb70-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-238"><a href="#cb70-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-239"><a href="#cb70-239" aria-hidden="true" tabindex="-1"></a>Beware: This method isn't perfect, as it doesn't add <span class="in">`return()`</span> around <span class="in">`result`</span> or ensure that you have written code to create outputs. But it can save you time.</span>
<span id="cb70-240"><a href="#cb70-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-241"><a href="#cb70-241" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pseudocode</span></span>
<span id="cb70-242"><a href="#cb70-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-243"><a href="#cb70-243" aria-hidden="true" tabindex="-1"></a>Before you write the 'do stuff' code inside a function - or indeed any complex code - it’s often helpful to write 'pseudocode' first.</span>
<span id="cb70-244"><a href="#cb70-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-245"><a href="#cb70-245" aria-hidden="true" tabindex="-1"></a>Pseudocode is a plain-language or code-like description of what your function should do, which breaks the problem down into smaller steps or operations. It is not valid R code, and it is not meant to run. Instead, it’s a thinking and planning tool: you use it to clarify the logic of your function before you worry about syntax or bugs.</span>
<span id="cb70-246"><a href="#cb70-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-247"><a href="#cb70-247" aria-hidden="true" tabindex="-1"></a>Pseudocode has a number of advantages:</span>
<span id="cb70-248"><a href="#cb70-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-249"><a href="#cb70-249" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It forces you to be explicit about inputs and outputs. Many function bugs happen because we forget what goes in, what comes out, or what happens in between.</span>
<span id="cb70-250"><a href="#cb70-250" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It separates the logical problems from the coding problems. You can get the logic right first, then translate it into code.</span>
<span id="cb70-251"><a href="#cb70-251" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It makes debugging easier. If your function fails, you can compare your code to your pseudocode step-by-step and find where they diverge.</span>
<span id="cb70-252"><a href="#cb70-252" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It helps you communicate with other people in the future who might not understand your code, including your future self. Readers might not understand your code immediately, but they can usually understand pseudocode.</span>
<span id="cb70-253"><a href="#cb70-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-254"><a href="#cb70-254" aria-hidden="true" tabindex="-1"></a><span class="fu">### What does pseudocode look like?</span></span>
<span id="cb70-255"><a href="#cb70-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-256"><a href="#cb70-256" aria-hidden="true" tabindex="-1"></a>There isn’t one “correct” format of pseudocode. The main goal is always plain-language readability. A common style is:</span>
<span id="cb70-257"><a href="#cb70-257" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Start with what the function receives (inputs)</span>
<span id="cb70-258"><a href="#cb70-258" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>List the steps inside the function (do stuff)</span>
<span id="cb70-259"><a href="#cb70-259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>End with what it returns (output)</span>
<span id="cb70-260"><a href="#cb70-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-261"><a href="#cb70-261" aria-hidden="true" tabindex="-1"></a>Here is pseudocode for our <span class="in">`absolute_sum()`</span> function. Note that there is no particular standard for pseudocode, it is just something between text and code that runs.</span>
<span id="cb70-262"><a href="#cb70-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-263"><a href="#cb70-263" aria-hidden="true" tabindex="-1"></a><span class="in">```default</span></span>
<span id="cb70-264"><a href="#cb70-264" aria-hidden="true" tabindex="-1"></a><span class="in">absolute_sum function</span></span>
<span id="cb70-265"><a href="#cb70-265" aria-hidden="true" tabindex="-1"></a><span class="in">steps:</span></span>
<span id="cb70-266"><a href="#cb70-266" aria-hidden="true" tabindex="-1"></a><span class="in">  1. Add two numbers to get their sum</span></span>
<span id="cb70-267"><a href="#cb70-267" aria-hidden="true" tabindex="-1"></a><span class="in">  2. Take the absolute value of that sum</span></span>
<span id="cb70-268"><a href="#cb70-268" aria-hidden="true" tabindex="-1"></a><span class="in">  3. Returns the absolute value</span></span>
<span id="cb70-269"><a href="#cb70-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-270"><a href="#cb70-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-271"><a href="#cb70-271" aria-hidden="true" tabindex="-1"></a>Maybe we would then improve this by thinking about basic structure of any function, i.e., separating the inputs, 'do stuff' and outputs, and therefore the input variables that are used in the 'do stuff'. </span>
<span id="cb70-272"><a href="#cb70-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-273"><a href="#cb70-273" aria-hidden="true" tabindex="-1"></a><span class="in">```default</span></span>
<span id="cb70-274"><a href="#cb70-274" aria-hidden="true" tabindex="-1"></a><span class="in">absolute_sum function</span></span>
<span id="cb70-275"><a href="#cb70-275" aria-hidden="true" tabindex="-1"></a><span class="in">inputs(x, y)</span></span>
<span id="cb70-276"><a href="#cb70-276" aria-hidden="true" tabindex="-1"></a><span class="in">steps:</span></span>
<span id="cb70-277"><a href="#cb70-277" aria-hidden="true" tabindex="-1"></a><span class="in">  1. sum x, y</span></span>
<span id="cb70-278"><a href="#cb70-278" aria-hidden="true" tabindex="-1"></a><span class="in">  2. absolute of sum</span></span>
<span id="cb70-279"><a href="#cb70-279" aria-hidden="true" tabindex="-1"></a><span class="in">output:</span></span>
<span id="cb70-280"><a href="#cb70-280" aria-hidden="true" tabindex="-1"></a><span class="in">  absolute sum</span></span>
<span id="cb70-281"><a href="#cb70-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-282"><a href="#cb70-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-283"><a href="#cb70-283" aria-hidden="true" tabindex="-1"></a>We might then look up the existing R functions to do each of these steps, making the pseudocode increasingly code-like.</span>
<span id="cb70-284"><a href="#cb70-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-287"><a href="#cb70-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{text}</span></span>
<span id="cb70-288"><a href="#cb70-288" aria-hidden="true" tabindex="-1"></a><span class="in">absolute_sum</span></span>
<span id="cb70-289"><a href="#cb70-289" aria-hidden="true" tabindex="-1"></a><span class="in">inputs:</span></span>
<span id="cb70-290"><a href="#cb70-290" aria-hidden="true" tabindex="-1"></a><span class="in">  x, y</span></span>
<span id="cb70-291"><a href="#cb70-291" aria-hidden="true" tabindex="-1"></a><span class="in">do stuff:</span></span>
<span id="cb70-292"><a href="#cb70-292" aria-hidden="true" tabindex="-1"></a><span class="in">  sum &lt;- sum(x, y)</span></span>
<span id="cb70-293"><a href="#cb70-293" aria-hidden="true" tabindex="-1"></a><span class="in">  abs_sum &lt;- abs(sum)</span></span>
<span id="cb70-294"><a href="#cb70-294" aria-hidden="true" tabindex="-1"></a><span class="in">outputs:</span></span>
<span id="cb70-295"><a href="#cb70-295" aria-hidden="true" tabindex="-1"></a><span class="in">  abs_sum</span></span>
<span id="cb70-296"><a href="#cb70-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-297"><a href="#cb70-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-298"><a href="#cb70-298" aria-hidden="true" tabindex="-1"></a>At this point, you can get individual parts of the 'do stuff' working as R code.</span>
<span id="cb70-299"><a href="#cb70-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-302"><a href="#cb70-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-303"><a href="#cb70-303" aria-hidden="true" tabindex="-1"></a><span class="co"># example values</span></span>
<span id="cb70-304"><a href="#cb70-304" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb70-305"><a href="#cb70-305" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb70-306"><a href="#cb70-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-307"><a href="#cb70-307" aria-hidden="true" tabindex="-1"></a><span class="co"># draft of 'do stuff'</span></span>
<span id="cb70-308"><a href="#cb70-308" aria-hidden="true" tabindex="-1"></a>value_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(x, y)</span>
<span id="cb70-309"><a href="#cb70-309" aria-hidden="true" tabindex="-1"></a>value_absolute_sum <span class="ot">&lt;-</span> <span class="fu">abs</span>(value_sum)</span>
<span id="cb70-310"><a href="#cb70-310" aria-hidden="true" tabindex="-1"></a>value_absolute_sum</span>
<span id="cb70-311"><a href="#cb70-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-312"><a href="#cb70-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-313"><a href="#cb70-313" aria-hidden="true" tabindex="-1"></a>At this point, the 'do stuff' is working, and your pseudocode is now code. You have enough to go to the 'wrap it in a function' step.</span>
<span id="cb70-314"><a href="#cb70-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-315"><a href="#cb70-315" aria-hidden="true" tabindex="-1"></a><span class="fu">### More complex example</span></span>
<span id="cb70-316"><a href="#cb70-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-317"><a href="#cb70-317" aria-hidden="true" tabindex="-1"></a>The real value of pseudocode shows up when functions are more complex. </span>
<span id="cb70-318"><a href="#cb70-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-319"><a href="#cb70-319" aria-hidden="true" tabindex="-1"></a>For example, here is pseudocode for a very common simulation function that we will explore in the next chapter: generate one dataset for a Randomized Controlled Trial with two conditions, treatment and control, where the data in each condition comes from a normally distributed population. </span>
<span id="cb70-320"><a href="#cb70-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-323"><a href="#cb70-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{text}</span></span>
<span id="cb70-324"><a href="#cb70-324" aria-hidden="true" tabindex="-1"></a><span class="in">function: generate_data </span></span>
<span id="cb70-325"><a href="#cb70-325" aria-hidden="true" tabindex="-1"></a><span class="in">necessary steps, but not necessarily implemented in this order:</span></span>
<span id="cb70-326"><a href="#cb70-326" aria-hidden="true" tabindex="-1"></a><span class="in">  1. For control group, draw n_per_group values from a normal distribution with mean mu_control and sd sigma</span></span>
<span id="cb70-327"><a href="#cb70-327" aria-hidden="true" tabindex="-1"></a><span class="in">  2. For treatment group, draw n_per_group values from a normal distribution with mean mu_treatment and sd sigma</span></span>
<span id="cb70-328"><a href="#cb70-328" aria-hidden="true" tabindex="-1"></a><span class="in">  3. Combine both into one a data frame</span></span>
<span id="cb70-329"><a href="#cb70-329" aria-hidden="true" tabindex="-1"></a><span class="in">  4. Create a column that labels the groups, eg "control" vs "treatment"</span></span>
<span id="cb70-330"><a href="#cb70-330" aria-hidden="true" tabindex="-1"></a><span class="in">  5. End up with a data frame with 'group' and 'score' column; output this.</span></span>
<span id="cb70-331"><a href="#cb70-331" aria-hidden="true" tabindex="-1"></a><span class="in">inputs probably needed based on steps:</span></span>
<span id="cb70-332"><a href="#cb70-332" aria-hidden="true" tabindex="-1"></a><span class="in">- n_per_group, mu_control, mu_treatment, sigma</span></span>
<span id="cb70-333"><a href="#cb70-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-334"><a href="#cb70-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-335"><a href="#cb70-335" aria-hidden="true" tabindex="-1"></a>Notice something important: this is basically just a checklist. When you convert it to R code, you can translate each step one at a time and test as you go. You may need to reorder or change the steps, but it gives you a plan. If you get lost in your code, you can go back to check the plan.</span>
<span id="cb70-336"><a href="#cb70-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-337"><a href="#cb70-337" aria-hidden="true" tabindex="-1"></a><span class="fu">## Argument defaults</span></span>
<span id="cb70-338"><a href="#cb70-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-339"><a href="#cb70-339" aria-hidden="true" tabindex="-1"></a>Functions often have many arguments, not all of which you want to specify every time. Often, there are reasonable defaults.</span>
<span id="cb70-340"><a href="#cb70-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-341"><a href="#cb70-341" aria-hidden="true" tabindex="-1"></a>For example, imagine we needed a function to both a) calculate the mean of two numbers and b) round this mean. We might define a new function as:</span>
<span id="cb70-342"><a href="#cb70-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-345"><a href="#cb70-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-346"><a href="#cb70-346" aria-hidden="true" tabindex="-1"></a><span class="co"># define function</span></span>
<span id="cb70-347"><a href="#cb70-347" aria-hidden="true" tabindex="-1"></a>rounded_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, n_digits){</span>
<span id="cb70-348"><a href="#cb70-348" aria-hidden="true" tabindex="-1"></a>  mean_x_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb70-349"><a href="#cb70-349" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">round</span>(mean_x_y, <span class="at">digits =</span> n_digits)</span>
<span id="cb70-350"><a href="#cb70-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb70-351"><a href="#cb70-351" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-352"><a href="#cb70-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-353"><a href="#cb70-353" aria-hidden="true" tabindex="-1"></a><span class="co"># usage</span></span>
<span id="cb70-354"><a href="#cb70-354" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="dv">2</span>)</span>
<span id="cb70-355"><a href="#cb70-355" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="dv">3</span>)</span>
<span id="cb70-356"><a href="#cb70-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-357"><a href="#cb70-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-358"><a href="#cb70-358" aria-hidden="true" tabindex="-1"></a>In psychology, we often round things to two decimal places. If we want to set the <span class="in">`n_digits = 2`</span> by default, we can define this in the arguments when declaring the function:</span>
<span id="cb70-359"><a href="#cb70-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-362"><a href="#cb70-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-363"><a href="#cb70-363" aria-hidden="true" tabindex="-1"></a>rounded_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">n_digits =</span> <span class="dv">2</span>){</span>
<span id="cb70-364"><a href="#cb70-364" aria-hidden="true" tabindex="-1"></a>  mean_x_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb70-365"><a href="#cb70-365" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">round</span>(mean_x_y, <span class="at">digits =</span> n_digits)</span>
<span id="cb70-366"><a href="#cb70-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb70-367"><a href="#cb70-367" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-368"><a href="#cb70-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-369"><a href="#cb70-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-370"><a href="#cb70-370" aria-hidden="true" tabindex="-1"></a>Now, we don't need to provide n_digits every time. Unless told otherwise, <span class="in">`rounded_mean()`</span> will use <span class="in">`n_digits = 2`</span>.</span>
<span id="cb70-371"><a href="#cb70-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-374"><a href="#cb70-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-375"><a href="#cb70-375" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>)</span>
<span id="cb70-376"><a href="#cb70-376" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="dv">3</span>)</span>
<span id="cb70-377"><a href="#cb70-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-378"><a href="#cb70-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-379"><a href="#cb70-379" aria-hidden="true" tabindex="-1"></a>This can be useful when we have a very general function with reasonable defaults. For example, most of <span class="in">`effectize::cohens_d()`</span>'s arguments have default values:</span>
<span id="cb70-380"><a href="#cb70-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-383"><a href="#cb70-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-384"><a href="#cb70-384" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb70-385"><a href="#cb70-385" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb70-386"><a href="#cb70-386" aria-hidden="true" tabindex="-1"></a><span class="co"># from its documentation:</span></span>
<span id="cb70-387"><a href="#cb70-387" aria-hidden="true" tabindex="-1"></a><span class="fu">cohens_d</span>(</span>
<span id="cb70-388"><a href="#cb70-388" aria-hidden="true" tabindex="-1"></a>  x,</span>
<span id="cb70-389"><a href="#cb70-389" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb70-390"><a href="#cb70-390" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="cn">NULL</span>,</span>
<span id="cb70-391"><a href="#cb70-391" aria-hidden="true" tabindex="-1"></a>  <span class="at">pooled_sd =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-392"><a href="#cb70-392" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="dv">0</span>,</span>
<span id="cb70-393"><a href="#cb70-393" aria-hidden="true" tabindex="-1"></a>  <span class="at">paired =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-394"><a href="#cb70-394" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> <span class="cn">NULL</span>,</span>
<span id="cb70-395"><a href="#cb70-395" aria-hidden="true" tabindex="-1"></a>  <span class="at">adjust =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-396"><a href="#cb70-396" aria-hidden="true" tabindex="-1"></a>  <span class="at">ci =</span> <span class="fl">0.95</span>,</span>
<span id="cb70-397"><a href="#cb70-397" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">"two.sided"</span>,</span>
<span id="cb70-398"><a href="#cb70-398" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-399"><a href="#cb70-399" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb70-400"><a href="#cb70-400" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-401"><a href="#cb70-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-402"><a href="#cb70-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-403"><a href="#cb70-403" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checking inputs</span></span>
<span id="cb70-404"><a href="#cb70-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-405"><a href="#cb70-405" aria-hidden="true" tabindex="-1"></a>Functions written for R packages usually have many checks built into them. Users are likely to use - and misuse - functions in a variety of ways and often need informative feedback messages to help them fix code when it's wrong. </span>
<span id="cb70-406"><a href="#cb70-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-407"><a href="#cb70-407" aria-hidden="true" tabindex="-1"></a>For example, if you run the code <span class="in">`sum("hello", 3)`</span>, R will return the error message "Error in sum("hello", 3) : invalid 'type' (character) of argument" because you cannot add numbers and character variables. R might have it's flaws but it's not lawless, we <span class="co">[</span><span class="ot">leave that to javascript</span><span class="co">](https://github.com/denysdovhan/wtfjs)</span>.</span>
<span id="cb70-408"><a href="#cb70-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-409"><a href="#cb70-409" aria-hidden="true" tabindex="-1"></a>Functions written for simulation studies tend to be more 'brittle' or 'fragile': they work under a more limited range of conditions, don't handle errors or exceptions as well, and tend to break without returning clear error messages. In part, this is because the people writing stimulation studies know the code is for a specific purpose and don't need it to be very general. But, in part, it is also because the people writing simulations are less likely to have the same software engineering skillset as R package developers, who are more likely to write functions that follow the principles of "fail early, fail loudly".</span>
<span id="cb70-410"><a href="#cb70-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-411"><a href="#cb70-411" aria-hidden="true" tabindex="-1"></a>For example, there is nothing stopping us from running the following code using the function we just wrote:</span>
<span id="cb70-412"><a href="#cb70-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-415"><a href="#cb70-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-416"><a href="#cb70-416" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="sc">-</span><span class="dv">3</span>)</span>
<span id="cb70-417"><a href="#cb70-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-418"><a href="#cb70-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-419"><a href="#cb70-419" aria-hidden="true" tabindex="-1"></a>Think about the function's arguments and outputs: Does the output represent an error or not?</span>
<span id="cb70-420"><a href="#cb70-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-421"><a href="#cb70-421" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true" title="Click to show answer"}</span>
<span id="cb70-422"><a href="#cb70-422" aria-hidden="true" tabindex="-1"></a>Well... it depends. On the one hand, you can't round a number to less than zero decimal places. On the other hand, this makes certain types of inputs invalid or ignored without telling the user this. In other context, 'silent failures' like this might have serious impacts on the results of your simulation.</span>
<span id="cb70-423"><a href="#cb70-423" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-424"><a href="#cb70-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-425"><a href="#cb70-425" aria-hidden="true" tabindex="-1"></a><span class="fu">### checkmate</span></span>
<span id="cb70-426"><a href="#cb70-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-427"><a href="#cb70-427" aria-hidden="true" tabindex="-1"></a>Whether or not this specific example represents an error, the situation can be avoided by using adding input checks and error messages to our functions. This makes them 'harder', ie less brittle. It will also help you build your R skills towards being able to write R packages yourself.</span>
<span id="cb70-428"><a href="#cb70-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-431"><a href="#cb70-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-432"><a href="#cb70-432" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb70-433"><a href="#cb70-433" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb70-434"><a href="#cb70-434" aria-hidden="true" tabindex="-1"></a><span class="co"># in the local version of this .qmd file, you can run this code to see the error messages</span></span>
<span id="cb70-435"><a href="#cb70-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-436"><a href="#cb70-436" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(checkmate)</span>
<span id="cb70-437"><a href="#cb70-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-438"><a href="#cb70-438" aria-hidden="true" tabindex="-1"></a>rounded_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">n_digits =</span> <span class="dv">2</span>) {</span>
<span id="cb70-439"><a href="#cb70-439" aria-hidden="true" tabindex="-1"></a>  <span class="co"># input checks</span></span>
<span id="cb70-440"><a href="#cb70-440" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - check that x and y are both single numeric values</span></span>
<span id="cb70-441"><a href="#cb70-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_number</span>(x, <span class="at">finite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-442"><a href="#cb70-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_number</span>(y, <span class="at">finite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-443"><a href="#cb70-443" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - check that n_digits is a non-negative integer</span></span>
<span id="cb70-444"><a href="#cb70-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_count</span>(n_digits) </span>
<span id="cb70-445"><a href="#cb70-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-446"><a href="#cb70-446" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do stuff</span></span>
<span id="cb70-447"><a href="#cb70-447" aria-hidden="true" tabindex="-1"></a>  mean_x_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb70-448"><a href="#cb70-448" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">round</span>(mean_x_y, <span class="at">digits =</span> n_digits)</span>
<span id="cb70-449"><a href="#cb70-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-450"><a href="#cb70-450" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output</span></span>
<span id="cb70-451"><a href="#cb70-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb70-452"><a href="#cb70-452" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-453"><a href="#cb70-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-454"><a href="#cb70-454" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fl">2.1</span>, <span class="at">y =</span> <span class="fl">3.01</span>, <span class="at">n_digits =</span> <span class="sc">-</span><span class="dv">3</span>)</span>
<span id="cb70-455"><a href="#cb70-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-456"><a href="#cb70-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-457"><a href="#cb70-457" aria-hidden="true" tabindex="-1"></a>If you highlight and run the above code in your local version of this .qmd, it will return the error "Error in rounded_mean(x = 2.1, y = 3.01, n_digits = -3) : Assertion on 'n_digits' failed: Must be &gt;= 0."</span>
<span id="cb70-458"><a href="#cb70-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-459"><a href="#cb70-459" aria-hidden="true" tabindex="-1"></a>The {checkmate} library has many other functions for checking other types of inputs.</span>
<span id="cb70-460"><a href="#cb70-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-461"><a href="#cb70-461" aria-hidden="true" tabindex="-1"></a>Note that there are many other ways of checking inputs, including R's build in methods and other R packages. These include:</span>
<span id="cb70-462"><a href="#cb70-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-463"><a href="#cb70-463" aria-hidden="true" tabindex="-1"></a><span class="fu">### Base-R `match.arg()`</span></span>
<span id="cb70-464"><a href="#cb70-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-467"><a href="#cb70-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-468"><a href="#cb70-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb70-469"><a href="#cb70-469" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb70-470"><a href="#cb70-470" aria-hidden="true" tabindex="-1"></a><span class="co"># in the local version of this .qmd file, you can run this code to see the error messages</span></span>
<span id="cb70-471"><a href="#cb70-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-472"><a href="#cb70-472" aria-hidden="true" tabindex="-1"></a>calculate_stat <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>)) {</span>
<span id="cb70-473"><a href="#cb70-473" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-474"><a href="#cb70-474" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check input </span></span>
<span id="cb70-475"><a href="#cb70-475" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - if 'type' isn't "mean" or "median", R stops here and errors</span></span>
<span id="cb70-476"><a href="#cb70-476" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - if the user provides nothing, it uses the first one ("mean")</span></span>
<span id="cb70-477"><a href="#cb70-477" aria-hidden="true" tabindex="-1"></a>  type <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(type)</span>
<span id="cb70-478"><a href="#cb70-478" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-479"><a href="#cb70-479" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"mean"</span>) {</span>
<span id="cb70-480"><a href="#cb70-480" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">mean</span>(x))</span>
<span id="cb70-481"><a href="#cb70-481" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-482"><a href="#cb70-482" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-483"><a href="#cb70-483" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"median"</span>) {</span>
<span id="cb70-484"><a href="#cb70-484" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">median</span>(x))</span>
<span id="cb70-485"><a href="#cb70-485" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-486"><a href="#cb70-486" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-487"><a href="#cb70-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-488"><a href="#cb70-488" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">100</span>)</span>
<span id="cb70-489"><a href="#cb70-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-490"><a href="#cb70-490" aria-hidden="true" tabindex="-1"></a><span class="co"># this works </span></span>
<span id="cb70-491"><a href="#cb70-491" aria-hidden="true" tabindex="-1"></a><span class="fu">calculate_stat</span>(my_data, <span class="st">"mean"</span>)</span>
<span id="cb70-492"><a href="#cb70-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-493"><a href="#cb70-493" aria-hidden="true" tabindex="-1"></a><span class="co"># this works </span></span>
<span id="cb70-494"><a href="#cb70-494" aria-hidden="true" tabindex="-1"></a><span class="fu">calculate_stat</span>(my_data, <span class="st">"median"</span>)</span>
<span id="cb70-495"><a href="#cb70-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-496"><a href="#cb70-496" aria-hidden="true" tabindex="-1"></a><span class="co"># this fails appropriately ("mode" is not an allowed input)</span></span>
<span id="cb70-497"><a href="#cb70-497" aria-hidden="true" tabindex="-1"></a><span class="fu">calculate_stat</span>(my_data, <span class="st">"mode"</span>)</span>
<span id="cb70-498"><a href="#cb70-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-499"><a href="#cb70-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-500"><a href="#cb70-500" aria-hidden="true" tabindex="-1"></a><span class="fu">### Base-R `stop()`</span></span>
<span id="cb70-501"><a href="#cb70-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-504"><a href="#cb70-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-505"><a href="#cb70-505" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb70-506"><a href="#cb70-506" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb70-507"><a href="#cb70-507" aria-hidden="true" tabindex="-1"></a><span class="co"># in the local version of this .qmd file, you can run this code to see the error messages</span></span>
<span id="cb70-508"><a href="#cb70-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-509"><a href="#cb70-509" aria-hidden="true" tabindex="-1"></a>double_allowed_inputs <span class="ot">&lt;-</span> <span class="cf">function</span>(val) {</span>
<span id="cb70-510"><a href="#cb70-510" aria-hidden="true" tabindex="-1"></a>  allowed <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb70-511"><a href="#cb70-511" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-512"><a href="#cb70-512" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>val <span class="sc">%in%</span> allowed) {</span>
<span id="cb70-513"><a href="#cb70-513" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"val must be 1, 10, or 100"</span>)</span>
<span id="cb70-514"><a href="#cb70-514" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-515"><a href="#cb70-515" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-516"><a href="#cb70-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(val <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb70-517"><a href="#cb70-517" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-518"><a href="#cb70-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-519"><a href="#cb70-519" aria-hidden="true" tabindex="-1"></a><span class="co"># this works</span></span>
<span id="cb70-520"><a href="#cb70-520" aria-hidden="true" tabindex="-1"></a><span class="fu">double_allowed_inputs</span>(<span class="at">val =</span> <span class="dv">10</span>)</span>
<span id="cb70-521"><a href="#cb70-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-522"><a href="#cb70-522" aria-hidden="true" tabindex="-1"></a><span class="co"># this fails appropriately</span></span>
<span id="cb70-523"><a href="#cb70-523" aria-hidden="true" tabindex="-1"></a><span class="fu">double_allowed_inputs</span>(<span class="at">val =</span> <span class="dv">6</span>)</span>
<span id="cb70-524"><a href="#cb70-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-525"><a href="#cb70-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-526"><a href="#cb70-526" aria-hidden="true" tabindex="-1"></a>See also <span class="in">`stopifnot()`</span>.</span>
<span id="cb70-527"><a href="#cb70-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-528"><a href="#cb70-528" aria-hidden="true" tabindex="-1"></a><span class="fu">### assertthat</span></span>
<span id="cb70-529"><a href="#cb70-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-530"><a href="#cb70-530" aria-hidden="true" tabindex="-1"></a>Another R library that is often used for checking inputs is {assertthat}, which focuses on readable error messages.</span>
<span id="cb70-531"><a href="#cb70-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-534"><a href="#cb70-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-535"><a href="#cb70-535" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb70-536"><a href="#cb70-536" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb70-537"><a href="#cb70-537" aria-hidden="true" tabindex="-1"></a><span class="co"># in the local version of this .qmd file, you can run this code to see the error messages</span></span>
<span id="cb70-538"><a href="#cb70-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-539"><a href="#cb70-539" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(assertthat)</span>
<span id="cb70-540"><a href="#cb70-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-541"><a href="#cb70-541" aria-hidden="true" tabindex="-1"></a>rounded_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">n_digits =</span> <span class="dv">2</span>) {</span>
<span id="cb70-542"><a href="#cb70-542" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check inputs</span></span>
<span id="cb70-543"><a href="#cb70-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">is.number</span>(x))</span>
<span id="cb70-544"><a href="#cb70-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">is.number</span>(y))</span>
<span id="cb70-545"><a href="#cb70-545" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">is.count</span>(n_digits))</span>
<span id="cb70-546"><a href="#cb70-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-547"><a href="#cb70-547" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do stuff</span></span>
<span id="cb70-548"><a href="#cb70-548" aria-hidden="true" tabindex="-1"></a>  mean_x_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb70-549"><a href="#cb70-549" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">round</span>(mean_x_y, <span class="at">digits =</span> n_digits)</span>
<span id="cb70-550"><a href="#cb70-550" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-551"><a href="#cb70-551" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output</span></span>
<span id="cb70-552"><a href="#cb70-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb70-553"><a href="#cb70-553" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-554"><a href="#cb70-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-555"><a href="#cb70-555" aria-hidden="true" tabindex="-1"></a><span class="co"># this works</span></span>
<span id="cb70-556"><a href="#cb70-556" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="dv">10</span>, <span class="dv">20</span>) </span>
<span id="cb70-557"><a href="#cb70-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-558"><a href="#cb70-558" aria-hidden="true" tabindex="-1"></a><span class="co"># this fails with: "x is not a number (a length one numeric vector)."</span></span>
<span id="cb70-559"><a href="#cb70-559" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>), <span class="at">y =</span> <span class="dv">30</span>) </span>
<span id="cb70-560"><a href="#cb70-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-561"><a href="#cb70-561" aria-hidden="true" tabindex="-1"></a><span class="co"># this fails with: "n_digits is not a count (a single positive integer)."</span></span>
<span id="cb70-562"><a href="#cb70-562" aria-hidden="true" tabindex="-1"></a><span class="fu">rounded_mean</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="at">n_digits =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb70-563"><a href="#cb70-563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-564"><a href="#cb70-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-565"><a href="#cb70-565" aria-hidden="true" tabindex="-1"></a><span class="fu">### Do as we say, not as we do</span></span>
<span id="cb70-566"><a href="#cb70-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-567"><a href="#cb70-567" aria-hidden="true" tabindex="-1"></a>SPOILER: Throughout this book, to make the code as simple as possible, we almost universally ignore our own advice here and do not include input checks in the functions we write.  </span>
<span id="cb70-568"><a href="#cb70-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-569"><a href="#cb70-569" aria-hidden="true" tabindex="-1"></a><span class="fu">## Common mistakes</span></span>
<span id="cb70-570"><a href="#cb70-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-571"><a href="#cb70-571" aria-hidden="true" tabindex="-1"></a><span class="fu">### Failing to declare your function</span></span>
<span id="cb70-572"><a href="#cb70-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-573"><a href="#cb70-573" aria-hidden="true" tabindex="-1"></a>The function must be present in your environment to be usable. After you write your function, you must run the code that declares it before you can use it. If you can't see your function in your environment tab under 'Functions', you need to run the code that contains the <span class="in">`function()`</span> call and assigns it a name.</span>
<span id="cb70-574"><a href="#cb70-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-575"><a href="#cb70-575" aria-hidden="true" tabindex="-1"></a><span class="fu">### Code that runs vs. functions correctly</span></span>
<span id="cb70-576"><a href="#cb70-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-577"><a href="#cb70-577" aria-hidden="true" tabindex="-1"></a>You must cautiously check that your function actually *works* as you expect, not just that the code runs. Give it lots of different input values that should and should not work, and check you get the correct outputs. We have often made the following mistake when writing functions, and you likely will too. </span>
<span id="cb70-578"><a href="#cb70-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-579"><a href="#cb70-579" aria-hidden="true" tabindex="-1"></a>Check your learning: what is the error in this code? Why does it run without errors?</span>
<span id="cb70-580"><a href="#cb70-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-583"><a href="#cb70-583" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-584"><a href="#cb70-584" aria-hidden="true" tabindex="-1"></a>absolute_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b){</span>
<span id="cb70-585"><a href="#cb70-585" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(x, y))</span>
<span id="cb70-586"><a href="#cb70-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb70-587"><a href="#cb70-587" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-588"><a href="#cb70-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-589"><a href="#cb70-589" aria-hidden="true" tabindex="-1"></a><span class="fu">absolute_sum</span>(<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb70-590"><a href="#cb70-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-591"><a href="#cb70-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-592"><a href="#cb70-592" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true" title="Click to show answer"}</span>
<span id="cb70-593"><a href="#cb70-593" aria-hidden="true" tabindex="-1"></a>The function's inputs are defined as a and b, but it actually uses x and y. x and y were defined as global variables earlier in the script, so it will run using these two values every time, eg <span class="in">`absolute_sum(1, 5)`</span> and <span class="in">`absolute_sum(31, 39)`</span> will return the same result.</span>
<span id="cb70-594"><a href="#cb70-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-595"><a href="#cb70-595" aria-hidden="true" tabindex="-1"></a>This often happens - as least to us - when we use common object names like <span class="in">`dat`</span> and forget to rename them when converting code to a function.</span>
<span id="cb70-596"><a href="#cb70-596" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-597"><a href="#cb70-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-598"><a href="#cb70-598" aria-hidden="true" tabindex="-1"></a><span class="fu">## Applied example: The false positive rate of AI detection tools</span></span>
<span id="cb70-599"><a href="#cb70-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-600"><a href="#cb70-600" aria-hidden="true" tabindex="-1"></a>Imagine a test has has a false positive rate of 5%, like the standard alpha value for a p-value. </span>
<span id="cb70-601"><a href="#cb70-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-602"><a href="#cb70-602" aria-hidden="true" tabindex="-1"></a>If you apply this test many times to independent cases without applying familywise error corrections, what is the resulting false positive rate?</span>
<span id="cb70-603"><a href="#cb70-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-604"><a href="#cb70-604" aria-hidden="true" tabindex="-1"></a>Let's put this in meaningful terms: Many professors and universities now run essays and assignments through AI detection tools. But students submit many essays and assignments throughout their degree. What is the probability that, assuming you never violate the AI policy, one of your assignments is falsely flagged as using AI in a way that wasn't allowed? </span>
<span id="cb70-605"><a href="#cb70-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-606"><a href="#cb70-606" aria-hidden="true" tabindex="-1"></a><span class="fu">### Math</span></span>
<span id="cb70-607"><a href="#cb70-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-608"><a href="#cb70-608" aria-hidden="true" tabindex="-1"></a>The familywise error rate ($\alpha_{\text{total}}$) for independent tests is the probability of observing at least one false positive ($P(V \geq 1)$), which can be reexpressed as the probability of not observing true positives ($1 - P(V = 0)$). This is the product of the individual probabilities of false positives ($1 - \prod_{i=1}^{n} (1 - \alpha_i)$), which simplifies to:</span>
<span id="cb70-609"><a href="#cb70-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-610"><a href="#cb70-610" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb70-611"><a href="#cb70-611" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb70-612"><a href="#cb70-612" aria-hidden="true" tabindex="-1"></a>\alpha_{\text{total}} &amp;= P(V \geq 1) <span class="sc">\\</span></span>
<span id="cb70-613"><a href="#cb70-613" aria-hidden="true" tabindex="-1"></a>&amp;= 1 - P(V = 0) <span class="sc">\\</span></span>
<span id="cb70-614"><a href="#cb70-614" aria-hidden="true" tabindex="-1"></a>&amp;= 1 - \prod_{i=1}^{n} (1 - \alpha_i) <span class="sc">\\</span></span>
<span id="cb70-615"><a href="#cb70-615" aria-hidden="true" tabindex="-1"></a>&amp;= 1 - (1 - \alpha)^n</span>
<span id="cb70-616"><a href="#cb70-616" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb70-617"><a href="#cb70-617" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb70-618"><a href="#cb70-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-619"><a href="#cb70-619" aria-hidden="true" tabindex="-1"></a>Horrible, disgusting math which most of you want to avoid. But the code to do it is quite simple.</span>
<span id="cb70-620"><a href="#cb70-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-621"><a href="#cb70-621" aria-hidden="true" tabindex="-1"></a><span class="fu">### Write the 'do stuff'</span></span>
<span id="cb70-622"><a href="#cb70-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-623"><a href="#cb70-623" aria-hidden="true" tabindex="-1"></a>This code implements the math assuming each individual test's false positive rate is 5% and that 10 total tests are run. It calculates the aggregate false positive rate, i.e., the probability that at least one test will show a false positive, assuming the null hypothesis is true. </span>
<span id="cb70-624"><a href="#cb70-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-627"><a href="#cb70-627" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-628"><a href="#cb70-628" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span>)<span class="sc">^</span><span class="dv">10</span></span>
<span id="cb70-629"><a href="#cb70-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-630"><a href="#cb70-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-631"><a href="#cb70-631" aria-hidden="true" tabindex="-1"></a>Check your learning: What do we mean by 'assuming the null hypothesis is true' here?</span>
<span id="cb70-632"><a href="#cb70-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-633"><a href="#cb70-633" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true" title="Click to show answer"}</span>
<span id="cb70-634"><a href="#cb70-634" aria-hidden="true" tabindex="-1"></a>This calculation only considers false positives, not true positives. In the world it considered - ie assumes - all positives are false positives: no true violations of the AI policy ever occur.</span>
<span id="cb70-635"><a href="#cb70-635" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb70-636"><a href="#cb70-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-637"><a href="#cb70-637" aria-hidden="true" tabindex="-1"></a><span class="fu">### Convert hard-coded values to variables</span></span>
<span id="cb70-638"><a href="#cb70-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-639"><a href="#cb70-639" aria-hidden="true" tabindex="-1"></a>What about other values of alpha and n? We could make them variables at the top of the chunk that are easier to change.</span>
<span id="cb70-640"><a href="#cb70-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-643"><a href="#cb70-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-644"><a href="#cb70-644" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb70-645"><a href="#cb70-645" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb70-646"><a href="#cb70-646" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb70-647"><a href="#cb70-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-648"><a href="#cb70-648" aria-hidden="true" tabindex="-1"></a><span class="co"># code</span></span>
<span id="cb70-649"><a href="#cb70-649" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> alpha)<span class="sc">^</span>n</span>
<span id="cb70-650"><a href="#cb70-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-651"><a href="#cb70-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-652"><a href="#cb70-652" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wrap it in a function</span></span>
<span id="cb70-653"><a href="#cb70-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-654"><a href="#cb70-654" aria-hidden="true" tabindex="-1"></a>Defining our own custom function involves putting the variables as arguments inside the <span class="in">`function()`</span> call, and putting the code inside its <span class="in">`{ }`</span>.</span>
<span id="cb70-655"><a href="#cb70-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-656"><a href="#cb70-656" aria-hidden="true" tabindex="-1"></a>We can then call the function using its name.</span>
<span id="cb70-657"><a href="#cb70-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-660"><a href="#cb70-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-661"><a href="#cb70-661" aria-hidden="true" tabindex="-1"></a><span class="co"># define function</span></span>
<span id="cb70-662"><a href="#cb70-662" aria-hidden="true" tabindex="-1"></a>calc_aggregate_fpr <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">alpha =</span> <span class="fl">0.05</span>) {</span>
<span id="cb70-663"><a href="#cb70-663" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> alpha)<span class="sc">^</span>n</span>
<span id="cb70-664"><a href="#cb70-664" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-665"><a href="#cb70-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-666"><a href="#cb70-666" aria-hidden="true" tabindex="-1"></a><span class="co"># usage</span></span>
<span id="cb70-667"><a href="#cb70-667" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb70-668"><a href="#cb70-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-669"><a href="#cb70-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-670"><a href="#cb70-670" aria-hidden="true" tabindex="-1"></a>This also lets us call it an arbitrary number of times, eg for different values of n</span>
<span id="cb70-671"><a href="#cb70-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-674"><a href="#cb70-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-675"><a href="#cb70-675" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span>  <span class="dv">5</span>)</span>
<span id="cb70-676"><a href="#cb70-676" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb70-677"><a href="#cb70-677" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">15</span>)</span>
<span id="cb70-678"><a href="#cb70-678" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb70-679"><a href="#cb70-679" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_aggregate_fpr</span>(<span class="at">n =</span> <span class="dv">25</span>)</span>
<span id="cb70-680"><a href="#cb70-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-681"><a href="#cb70-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-682"><a href="#cb70-682" aria-hidden="true" tabindex="-1"></a>At this point, we'll skip over some code and skills we haven't learned yet. In summary, we use the function we have just created to simulate many different values of <span class="in">`n`</span> (the number of tests run) and <span class="in">`alpha`</span> (the test's alpha value, or nominal false positive rate for a single test) to observe their impact on the familywise error rate across tests. We'll learn how to do this in future chapters. For the moment, let's just observe the results.</span>
<span id="cb70-683"><a href="#cb70-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-686"><a href="#cb70-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-687"><a href="#cb70-687" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb70-688"><a href="#cb70-688" aria-hidden="true" tabindex="-1"></a><span class="co"># dependencies</span></span>
<span id="cb70-689"><a href="#cb70-689" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb70-690"><a href="#cb70-690" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb70-691"><a href="#cb70-691" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb70-692"><a href="#cb70-692" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb70-693"><a href="#cb70-693" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb70-694"><a href="#cb70-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-695"><a href="#cb70-695" aria-hidden="true" tabindex="-1"></a><span class="co"># define many values of n and alpha, and then have them 'crossed' to create all permutations of them, using expand_grid()</span></span>
<span id="cb70-696"><a href="#cb70-696" aria-hidden="true" tabindex="-1"></a>experiment <span class="ot">&lt;-</span> </span>
<span id="cb70-697"><a href="#cb70-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb70-698"><a href="#cb70-698" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>)) </span>
<span id="cb70-699"><a href="#cb70-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-700"><a href="#cb70-700" aria-hidden="true" tabindex="-1"></a><span class="co"># run the stimulation</span></span>
<span id="cb70-701"><a href="#cb70-701" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> experiment <span class="sc">|&gt;</span>  </span>
<span id="cb70-702"><a href="#cb70-702" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use mutate to create a new column, fpr, by calling the custom function for each row</span></span>
<span id="cb70-703"><a href="#cb70-703" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use a map2_ function as there are two inputs, n and alpha</span></span>
<span id="cb70-704"><a href="#cb70-704" aria-hidden="true" tabindex="-1"></a>  <span class="co"># these are passed by location, .x to the first argument, .y to the second</span></span>
<span id="cb70-705"><a href="#cb70-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fpr =</span> <span class="fu">map2_dbl</span>(<span class="at">.x =</span> n, </span>
<span id="cb70-706"><a href="#cb70-706" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.y =</span> alpha,</span>
<span id="cb70-707"><a href="#cb70-707" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.f =</span> calc_aggregate_fpr))</span>
<span id="cb70-708"><a href="#cb70-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-709"><a href="#cb70-709" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb70-710"><a href="#cb70-710" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span></span>
<span id="cb70-711"><a href="#cb70-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> <span class="fu">as.factor</span>(alpha)) <span class="sc">|&gt;</span></span>
<span id="cb70-712"><a href="#cb70-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, fpr, <span class="at">color =</span> alpha, <span class="at">group =</span> alpha)) <span class="sc">+</span></span>
<span id="cb70-713"><a href="#cb70-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb70-714"><a href="#cb70-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-715"><a href="#cb70-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb70-716"><a href="#cb70-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Number of AI tests run"</span>,</span>
<span id="cb70-717"><a href="#cb70-717" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>),</span>
<span id="cb70-718"><a href="#cb70-718" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb70-719"><a href="#cb70-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Familywise False Positive Rate"</span>,</span>
<span id="cb70-720"><a href="#cb70-720" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb70-721"><a href="#cb70-721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-722"><a href="#cb70-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-723"><a href="#cb70-723" aria-hidden="true" tabindex="-1"></a>Despite the test being advertised as having high accuracy, in the sense of a low false-positive rate, there is a strong risk of false positives when many tests are run. Students submit many different assignments over their studies. Assuming no AI policy violations occur, 20 assignments are tested, the tests are independent, and an alpha value of 5% is used, there is a strong risk (&gt; 50%) that individual students will still have at least one of their assignments flagged as an AI policy violation across their studies.</span>
<span id="cb70-724"><a href="#cb70-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-725"><a href="#cb70-725" aria-hidden="true" tabindex="-1"></a>This gets even worse when we consider that there are many students, each of which are submitting many assignments. If we track all 25 students in a symposium over 20 assignments they submit, the estimated familywise false positive rate is <span class="in">`r calc_aggregate_fpr(n = 25 * 20) *100`</span>%. Whew.</span>
<span id="cb70-726"><a href="#cb70-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-727"><a href="#cb70-727" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb70-728"><a href="#cb70-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-729"><a href="#cb70-729" aria-hidden="true" tabindex="-1"></a>Write functions for each of the following. Remember that you can write pseudocode first if it helps.</span>
<span id="cb70-730"><a href="#cb70-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-731"><a href="#cb70-731" aria-hidden="true" tabindex="-1"></a><span class="fu">### Convert milliseconds to seconds</span></span>
<span id="cb70-732"><a href="#cb70-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-735"><a href="#cb70-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-736"><a href="#cb70-736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-737"><a href="#cb70-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-738"><a href="#cb70-738" aria-hidden="true" tabindex="-1"></a><span class="fu">### Convert n_months to n_years and round all values up the next year </span></span>
<span id="cb70-739"><a href="#cb70-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-740"><a href="#cb70-740" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`ceiling()`</span> to round all values ending in something other than .0 up to the next whole value.</span>
<span id="cb70-741"><a href="#cb70-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-744"><a href="#cb70-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-745"><a href="#cb70-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-746"><a href="#cb70-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-747"><a href="#cb70-747" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calcualte mean by group</span></span>
<span id="cb70-748"><a href="#cb70-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-749"><a href="#cb70-749" aria-hidden="true" tabindex="-1"></a>What additional arguments might this benefit from to avoid it breaking under common use cases?</span>
<span id="cb70-750"><a href="#cb70-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-753"><a href="#cb70-753" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-754"><a href="#cb70-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-755"><a href="#cb70-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-756"><a href="#cb70-756" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate mean, SD, and N by group</span></span>
<span id="cb70-757"><a href="#cb70-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-760"><a href="#cb70-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-761"><a href="#cb70-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-762"><a href="#cb70-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-763"><a href="#cb70-763" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean, SD, and N by group, and differences in means between groups</span></span>
<span id="cb70-764"><a href="#cb70-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-765"><a href="#cb70-765" aria-hidden="true" tabindex="-1"></a>Pivot the result to wider format before mutating the difference in means.</span>
<span id="cb70-766"><a href="#cb70-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-769"><a href="#cb70-769" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-770"><a href="#cb70-770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-771"><a href="#cb70-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-772"><a href="#cb70-772" aria-hidden="true" tabindex="-1"></a><span class="fu">### Generate a random number between 0 and 9 using `runif()`</span></span>
<span id="cb70-773"><a href="#cb70-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-776"><a href="#cb70-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-777"><a href="#cb70-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-778"><a href="#cb70-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-779"><a href="#cb70-779" aria-hidden="true" tabindex="-1"></a><span class="fu">### Generate two random numbers between 0 and 9, return only the larger one</span></span>
<span id="cb70-780"><a href="#cb70-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-783"><a href="#cb70-783" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-784"><a href="#cb70-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-785"><a href="#cb70-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-786"><a href="#cb70-786" aria-hidden="true" tabindex="-1"></a><span class="fu">### Remove the ' ms' suffix from data like "2000 ms" </span></span>
<span id="cb70-787"><a href="#cb70-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-788"><a href="#cb70-788" aria-hidden="true" tabindex="-1"></a>Use the {stringr} library.</span>
<span id="cb70-789"><a href="#cb70-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-792"><a href="#cb70-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-793"><a href="#cb70-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-794"><a href="#cb70-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-795"><a href="#cb70-795" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tidy messy open-ended gender data</span></span>
<span id="cb70-796"><a href="#cb70-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-797"><a href="#cb70-797" aria-hidden="true" tabindex="-1"></a>You can use the <span class="in">`dat_demographics_messy`</span> tibble created below.</span>
<span id="cb70-798"><a href="#cb70-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-801"><a href="#cb70-801" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-802"><a href="#cb70-802" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb70-803"><a href="#cb70-803" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dataset to be cleaned</span></span>
<span id="cb70-804"><a href="#cb70-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-805"><a href="#cb70-805" aria-hidden="true" tabindex="-1"></a><span class="co"># install the devtools and truffle packages if you don't have them already:</span></span>
<span id="cb70-806"><a href="#cb70-806" aria-hidden="true" tabindex="-1"></a><span class="co"># library(devtools)</span></span>
<span id="cb70-807"><a href="#cb70-807" aria-hidden="true" tabindex="-1"></a><span class="co"># install_github("ianhussey/truffle")</span></span>
<span id="cb70-808"><a href="#cb70-808" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(truffle)</span>
<span id="cb70-809"><a href="#cb70-809" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb70-810"><a href="#cb70-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-811"><a href="#cb70-811" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb70-812"><a href="#cb70-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-813"><a href="#cb70-813" aria-hidden="true" tabindex="-1"></a>dat_demographics_messy <span class="ot">&lt;-</span> </span>
<span id="cb70-814"><a href="#cb70-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb70-815"><a href="#cb70-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dirt_demographics</span>()</span>
<span id="cb70-816"><a href="#cb70-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-817"><a href="#cb70-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-818"><a href="#cb70-818" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tidy messy age data</span></span>
<span id="cb70-819"><a href="#cb70-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-820"><a href="#cb70-820" aria-hidden="true" tabindex="-1"></a>You can use the <span class="in">`dat_demographics_messy`</span> tibble again.</span>
<span id="cb70-821"><a href="#cb70-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-824"><a href="#cb70-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-825"><a href="#cb70-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-826"><a href="#cb70-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-827"><a href="#cb70-827" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample data from a normal distribution and return a tibble  </span></span>
<span id="cb70-828"><a href="#cb70-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-829"><a href="#cb70-829" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`rnorm()`</span></span>
<span id="cb70-830"><a href="#cb70-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-833"><a href="#cb70-833" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-834"><a href="#cb70-834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-835"><a href="#cb70-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-836"><a href="#cb70-836" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample data from a normal distribution, round to the nearest whole number, and return a tibble  </span></span>
<span id="cb70-837"><a href="#cb70-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-840"><a href="#cb70-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-841"><a href="#cb70-841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-842"><a href="#cb70-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-843"><a href="#cb70-843" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample data from a normal distribution, calculate its average, and return a tibble </span></span>
<span id="cb70-844"><a href="#cb70-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-847"><a href="#cb70-847" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-848"><a href="#cb70-848" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-849"><a href="#cb70-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-850"><a href="#cb70-850" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate the probabilty of n number of 'heads' coin flips in a row</span></span>
<span id="cb70-851"><a href="#cb70-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-852"><a href="#cb70-852" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`rbinom()`</span>.</span>
<span id="cb70-853"><a href="#cb70-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-856"><a href="#cb70-856" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-857"><a href="#cb70-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-858"><a href="#cb70-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-859"><a href="#cb70-859" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample data from two normal disributions, return a tibble with two columns called intervention and control</span></span>
<span id="cb70-860"><a href="#cb70-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-863"><a href="#cb70-863" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-864"><a href="#cb70-864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb70-865"><a href="#cb70-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-866"><a href="#cb70-866" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample data from two normal disributions, return a tibble in long format with a 'score' and 'condition' column</span></span>
<span id="cb70-867"><a href="#cb70-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-868"><a href="#cb70-868" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`bind_rows()`</span>.</span>
<span id="cb70-869"><a href="#cb70-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-872"><a href="#cb70-872" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-873"><a href="#cb70-873" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>